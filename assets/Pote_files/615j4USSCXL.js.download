'use strict';mix_d("CustomerReviewsMediaCards__cr-media-carousel:cr-media-carousel__Ohij4abX","exports tslib @c/browser-operations @c/aui-feature-detect @c/scoped-dom @c/metrics @c/navigation @c/dom @c/remote-operations @c/logger @p/A".split(" "),function(db,g,wb,xb,yb,zb,Ab,ea,ta,Bb,Cb){function ra(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}function eb(a,b,c){return"https://"+xa()+"/portal/customer-reviews/media-gallery/ref="+a+"?ie=UTF8&asin="+c+"&mediaType="+b}function xa(){var a=
da["default"].getLocation&&da["default"].getLocation().hostname||location.href,b=da["default"].getLocation&&da["default"].getLocation().host||location.host;return"localhost"===a?"pre-prod.amazon.com":b}function Ha(a){return a?a===G.IMAGE?ia.IMAGE:ia.VIDEO:ia.ALL}function Db(a){return Object.keys(a).map(function(b){return b+"="+a[b]}).join("&")}function Eb(a,b){return g.__awaiter(this,void 0,void 0,function(){var c,d,e;return g.__generator(this,function(f){c=b.mediaType;d=b.metricsPrefix;N.logCounter(d+
"IvxClicked",1);e=Date.now();a.navigate({url:Fb(b),successCallback:function(){var h=Date.now()-e;N.logCounter(d+"IvxNavigatedDuration",h);N.logCounter(d+"IvxNavigated",1);N.logNoError("loadIVXError",c)},failCallback:function(h){N.logCounter(d+"IvxNavigated",0);fb("Failed to load SSNAP immersive modal for media: "+JSON.stringify(b)+".",h);N.logError("loadIVXError",c)}});return[2]})})}function Fb(a){var b=g.__assign,c=g.__assign,d=a.hidePivot,e=a.ingressType,f=a.isSingleReview,h=a.asin,l=a.refMarker,
m=a.metricsPrefix,t=a.reviewId,p=JSON,z=p.stringify;var k=a.mediaType===G.VIDEO;k=g.__assign({imageUrl:k?a.thumbnailUrl:a.url,physicalId:a.physicalId},k&&{videoUrl:a.url});a=b.call(g,c.call(g,{hidePivot:d,ingressType:e,isSingleReview:f,productAsin:h,refMarker:l,metricsPrefix:m,reviewId:t,viewData:z.call(p,[k])},a.filter&&{filter:a.filter}),a.mediaType===G.VIDEO?{videoUrl:a.url}:{imageUrl:a.url});return"ssnap://www.amazon.com/ive?"+Db(a)}var R=ra(wb),Gb=ra(xb),ya=ra(yb),da=ra(Ab),V=ra(ea),fa=ra(ta),
Ia=ra(Cb),G;(function(a){a.IMAGE="IMAGE";a.VIDEO="VIDEO"})(G||(G={}));var Ja=G,Ka,Hb=function(){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(a){return[2,new Promise(function(b){P.now("mash").execute(function(c){b(c)})})]})})},La=function(){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(a){switch(a.label){case 0:return Ka?[3,2]:[4,Hb()];case 1:Ka=a.sent(),a.label=2;case 2:return[2,Ka]}})})},Ib=function(){return g.__awaiter(void 0,
void 0,void 0,function(){return g.__generator(this,function(a){switch(a.label){case 0:return[4,La()];case 1:return[2,!!a.sent()]}})})},ha;(function(a){a.MWEB="mWeb";a.MSHOP="mShop";a.DESKTOP="desktop"})(ha||(ha={}));var Ma=function(){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(a){switch(a.label){case 0:return[4,Ib()];case 1:return[2,a.sent()]}})})},gb=function(){return"true"===ya["default"].cardRoot.getAttribute("data-mobile")||Gb["default"].isSupported("mobile")},
Jb=function(){return g.__awaiter(void 0,void 0,void 0,function(){var a;return g.__generator(this,function(b){switch(b.label){case 0:return(a=gb())?[4,Ma()]:[3,2];case 1:a=!b.sent(),b.label=2;case 2:return[2,a]}})})},hb=function(){return g.__awaiter(void 0,void 0,void 0,function(){var a;return g.__generator(this,function(b){switch(b.label){case 0:return[4,Ma()];case 1:if(!b.sent())return[3,2];a=ha.MSHOP;return[3,4];case 2:return[4,Jb()];case 3:a=b.sent()?ha.MWEB:ha.DESKTOP,b.label=4;case 4:return[2,
a]}})})},N=function(){function a(){}a.setPrefix=function(b){this.prefix=b+"."};a.logCounter=function(b,c,d){zb.count(""+this.prefix+(d?d+"."+b:b),c)};a.logError=function(b,c){this.logCounter(b,1,c)};a.logNoError=function(b,c){this.logCounter(b,0,c)};a.prefix="";return a}(),Na;(Na||(Na={})).clickHandler="CRImageThumbnailOpsClickHandler";var Kb=Na,Oa;(Oa||(Oa={})).clickHandler="CRSeeMoreThumbnailOpsClickHandler";var Lb=Oa,Pa;(Pa||(Pa={})).clickHandler="CRVideoThumbnailClickHandler";var Mb=Pa,ia;(function(a){a.IMAGE=
"image";a.VIDEO="video";a.ALL="all"})(ia||(ia={}));var za=function(){function a(b,c){this.popover=c;this.popoverOpenEventType="a-modal"===b?"afterShow":"afterSlide"}a.prototype.showSync=function(){var b=this;return new Promise(function(c){P.when("A").execute(function(d){var e="a:popover:"+b.popoverOpenEventType+":"+b.popover.name,f=function(){d.off(e,f);c()};d.on(e,f);b.show()})})};a.prototype.show=function(){this.popover.show()};a.prototype.hide=function(){this.popover.hide()};a.prototype.updatePosition=
function(){this.popover.updatePosition()};a.getPopoverByName=function(b){return this.popovers[b]};a.prototype.isOpen=function(){return this.popover.isActive()};a.createOrGet=function(b,c,d,e,f){var h=this;return new Promise(function(l){h.popovers[c]?l(h.popovers[c]):P.when(b).execute(function(m){ya["default"].scopeElement(d);m=m.create(e,f);h.popovers[c]=new a(b,m);l(h.popovers[c])})})};a.popovers={};return a}(),Nb={activate:"onclick",dataStrategy:"preload",hideHeader:!0,padding:"none"},ib={dataStrategy:"preload"},
Ob=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}g.__extends(b,a);b.get=function(c,d,e,f){f=f?g.__assign(g.__assign({},f),{name:c}):g.__assign(g.__assign({},Nb),{name:c});return a.createOrGet.call(this,"a-secondary-view",c,d,e,f)};return b}(za),Pb=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}g.__extends(b,a);b.get=function(c,d,e,f){f=f?g.__assign(g.__assign({},f),{name:c}):g.__assign(g.__assign({},ib),{name:c});return a.createOrGet.call(this,"a-modal",
c,d,e,f)};return b}(za),Qb=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}g.__extends(b,a);b.get=function(c,d,e,f){f=f?g.__assign(g.__assign({},f),{name:c}):g.__assign(g.__assign({},ib),{name:c});return a.createOrGet.call(this,"a-popover",c,d,e,f)};return b}(za),M=function(a){a.style.display="flex"},I=function(a){a.style.display="none"},W;(function(a){a[a.LEFT=0]="LEFT";a[a.CENTER=1]="CENTER";a[a.RIGHT=2]="RIGHT";a[a.NONE=3]="NONE"})(W||(W={}));var ua;(function(a){a[a.EXPAND=
0]="EXPAND";a[a.HIDE=1]="HIDE"})(ua||(ua={}));var Aa;(function(a){a[a.POTRAIT=0]="POTRAIT";a[a.LANDSCAPE=1]="LANDSCAPE"})(Aa||(Aa={}));var O=function(a,b){return(a=null===a||void 0===a?void 0:a.getElementsByClassName(b))?a[0]:null},Ea=function(a,b){var c;return null!==(c=null===a||void 0===a?void 0:a.querySelector(b))&&void 0!==c?c:null},A=function(a,b){a&&b(a)},jb=function(a){a=a.dataset;return{asin:a.asin,mediaType:G[a.mediatype],reviewId:a.reviewid,mediaId:a.physicalid||a.mediaid}},kb=function(a,
b){null===b||void 0===b?void 0:b.classList.remove(a)},lb=function(a,b){null===b||void 0===b?void 0:b.classList.add(a)},Rb=function(a){var b=O(a,"_Y3Itb_desktop-skeleton-container_738lf"),c=O(a,"_Y3Itb_desktop-spinner-container_1qNHr");return{show:function(){return A(b,function(d){return M(d)})},hide:function(){return A(b,function(d){return I(d)})},setLoadingAnimation:function(d){A(c,function(e){d?b&&M(e):I(e)})}}},Qa;(function(a){a.SingleReviewComponent="SingleReviewComponent";a.ProfileBlock="ProfileBlock";
a.ProfileBadge="ProfileBadge";a.Rating="Rating";a.RatingAlt="RatingAlt";a.ReviewText="ReviewText";a.ReviewTitle="ReviewTitle";a.MainMedia="MainMedia";a.ImageThumbnailsBlock="ImageThumbnailsBlock";a.GalleryBlock="GalleryBlock";a.SingleReviewMediaBlock="SingleReviewMediaBlock"})(Qa||(Qa={}));var F=Qa,Ra;(function(a){a.MainMedia="MainMedia";a.ImageThumbnailsBlock="ImageThumbnailsBlock";a.GalleryBlock="GalleryBlock";a.SingleReviewMediaBlock="SingleReviewMediaBlock"})(Ra||(Ra={}));var mb=Ra,Sa;(function(a){a.THANKYOU_MESSAGE_TOAST_BAR_NAME=
"thankYouMessageToastBarName";a.ERROR_MESSAGE_TOAST_BAR_NAME="errorMessageToastBarName";a.LOADPOPOVER_ERROR_TOAST_BAR_NAME="loadPopoverErrorToastBarName";a.DATA_POPOVER_NAME="data-popovername";a.DATA_ASIN="data-asin";a.DATA_MEDIATYPE="data-mediatype";a.DATA_SHOW_GALLERY_IN_MODAL="data-showgalleryinmodal";a.DATA_REVIEW_ID="data-reviewid";a.DATA_MEDIA_ID="data-mediaid";a.DATA_CSA_C_TYPE="data-csa-c-type";a.DATA_CSA_SLOT_ID="data-csa-c-slot-id";a.DATA_MULTIPLE_STARS_SUFFIX="data-multiple-starts-suffix";
a.DATA_ONE_STAR_SUFFIX="data-one-star-suffix";a.DATA_IMAGE_ALT_TEXT="data-imagealttext"})(Sa||(Sa={}));var L=Sa,Ta;(function(a){a.showMediaGalleryClickHandler="showMediaGalleryClickHandler";a.galleryItemClickHandler="galleryItemClickHandler";a.thumbnailClickHandler="thumbnailClickHandler";a.expandTextClickHandler="expandTextClickHandler";a.hideTextClickHandler="hideTextClickHandler";a.reloadMediaPopover="reloadMediaPopover";a.closeMediaPopover="closeMediaPopover";a.leftClickHandler="leftClickHandler";
a.rightClickHandler="rightClickHandler";a.openReportConfirmationDialogClickHandler="OpenReportConfirmationDialogClickHandler";a.confirmReportAbuseClickHandler="ConfirmReportAbuseClickHandler";a.noopHandler="noopHandler";a.helpfulVoteClickHandler="HelpfulVoteClickHandler"})(Ta||(Ta={}));var X=Ta,T;(function(a){a.UPDATE_TEXT="updateText";a.UPDATE_LANG="updateLang";a.REPLACE_CLASS="replaceClass";a.DELETE_CHILDREN="deleteChildren";a.APPEND_ELEMENT="appendElement";a.UPDATE_ELEMENT="UpdateElement"})(T||
(T={}));var Ua=function(a,b,c){a=Ea(a,"[data-reviewbind="+F[b]+"]");c&&a&&(a=Ea(a,c));return a},nb=function(a){var b=V["default"].cardRoot.ownerDocument.createElement(a.tag);A(a.elementAttributes,function(c){Object.keys(c).forEach(function(d){return b.setAttribute(d,c[d])})});A(a.children,function(c){c.forEach(function(d){d=nb(d);b.append(d)})});A(a.observer,function(c){c.observe(b)});A(a.clickHandler,function(c){c(b)});A(a.textContent,function(c){return b.textContent=c});return b},ob=function(a,
b){switch(b.type){case T.UPDATE_TEXT:A(a,function(c){var d,e=null!==(d=b.textContent)&&void 0!==d?d:"";c.textContent=e});break;case T.UPDATE_LANG:A(a,function(c){var d,e,f=c.textContent||"",h=c.dataset.reviewlanguage||"",l=c.dataset.originalText,m=null!==(d=b.textContent)&&void 0!==d?d:"";d=null===(e=c.dataset.locale)||void 0===e?void 0:e.slice(0,2);e=new Intl.DisplayNames([d],{type:"language"});l||(c.dataset.originalText=f);if("updateLang"==m){if(h=h.slice(0,2),h=e.of(h))c.textContent=f.replace("*",
h)}else l&&(c.textContent=c.dataset.originalText||"")});break;case T.REPLACE_CLASS:A(a,function(c){A(b.classPatternToBeReplaced,function(d){var e=Array.from(c.classList).find(function(f){return f.match(d)});A(e,function(f){return c.classList.remove(f)})});A(b.newClass,function(d){return c.classList.add(d)})});break;case T.APPEND_ELEMENT:A(a,function(c){var d;null===(d=b.elements)||void 0===d?void 0:d.forEach(function(e){c.append(nb(e))})});break;case T.DELETE_CHILDREN:A(a,function(c){for(;c.lastElementChild;)c.removeChild(c.lastElementChild)});
break;case T.UPDATE_ELEMENT:A(a,function(c){A(b.elementAttributes,function(d){Object.keys(d).forEach(function(e){return c.setAttribute(e,d[e])})})})}},Va=function(a,b){a&&b.forEach(function(c){var d=Ua(a,c.key,c.querySelector);ob(d,c)})},Sb=function(a,b){var c=b==G.IMAGE?"cm_cr_image_carousel_popover":"cm_cr_video_carousel_popover",d=R["default"].setup(),e=function(u,v){var x,D=null!==(x=v.mediaList.findIndex(b==G.IMAGE?function(J){var y;return(null===(y=J.image)||void 0===y?void 0:y.physicalId)==
u}:function(J){var y;return(null===(y=J.video)||void 0===y?void 0:y.physicalId)==u}))&&void 0!==x?x:0;return v.mediaList[D]},f=function(u,v,x){return[{type:T.UPDATE_TEXT,key:u,textContent:v,querySelector:x}]},h=function(u,v,x,D){return[{type:T.REPLACE_CLASS,key:u,classPatternToBeReplaced:v,newClass:x,querySelector:D}]},l=function(u,v,x){return[{key:u,type:T.UPDATE_ELEMENT,elementAttributes:v,querySelector:x}]},m=["_Y3Itb_media-popover-image-view-container_vTrQA","_Y3Itb_media-popover-image-view-active_2lj7U"],
t=function(u){var v=u.mediaGroup.mediaList.map(function(x){return b==G.IMAGE?x.image:x.video}).filter(function(x){return!!x}).map(function(x,D){var J,y=g.__assign,B=(J={class:u.mediaId==x.physicalId?m.join(" "):"_Y3Itb_media-popover-image-view-container_vTrQA"},J[L.DATA_MEDIA_ID]=x.physicalId,J);J=c+"_"+u.reviewId+"_"+u.reviewRank+"_"+x.physicalId+"_"+D;var r;D=(r={},r[L.DATA_CSA_C_TYPE]="element",r[L.DATA_CSA_SLOT_ID]=J,r);return{tag:"div",elementAttributes:y.call(g,B,D),children:[{tag:b==G.IMAGE?
"img":"video",elementAttributes:g.__assign({src:x.url,alt:x.altText,class:"_Y3Itb_media-popover-image-view_1FAQo"},b==G.VIDEO?{controls:"true"}:{})}]}});return[{type:T.DELETE_CHILDREN,key:F.MainMedia},{type:T.APPEND_ELEMENT,elements:v,key:F.MainMedia}]},p=function(u){if(b==G.VIDEO)return[];var v=k(F.ImageThumbnailsBlock,L.DATA_IMAGE_ALT_TEXT),x=u.mediaGroup.mediaList.map(function(D){return D.image}).filter(function(D){return!!D}).map(function(D){var J;return{tag:"li",elementAttributes:{class:"_Y3Itb_media-popover-list-item-style_1njtu"},
children:[{tag:"button",elementAttributes:(J={"aria-pressed":u.mediaId===D.physicalId?"true":"false",class:u.mediaId===D.physicalId?"_Y3Itb_media-popover-thumbnail-image-view-active_2W42O _Y3Itb_media-popover-thumbnail-image-button_1vtKQ":"_Y3Itb_media-popover-thumbnail-image-button_1vtKQ"},J[L.DATA_MEDIA_ID]=D.physicalId,J[L.DATA_MEDIATYPE]=b,J),children:[{tag:"img",elementAttributes:{src:D.thumbnailUrl,alt:v,class:"_Y3Itb_media-popover-thumbnail-image-view_3-Y40"}}],clickHandler:function(y){return d.attach(X.thumbnailClickHandler,
y)}}]}});return[{type:T.DELETE_CHILDREN,key:F.ImageThumbnailsBlock},{type:T.APPEND_ELEMENT,elements:x,key:F.ImageThumbnailsBlock}]},z=function(u,v,x){return g.__spread(f(u,x),l(u,{lang:v}))},k=function(u,v,x){var D;return(u=Ua(a,u,x))?null!==(D=u.getAttribute(v))&&void 0!==D?D:"":""},q=k(F.RatingAlt,L.DATA_MULTIPLE_STARS_SUFFIX),n=k(F.RatingAlt,L.DATA_ONE_STAR_SUFFIX),C=function(u,v,x){var D,J,y,B,r,w;switch(u){case F.ReviewText:return z(u,(null===(J=x.metadata)||void 0===J?void 0:J.sourceLanguage)||
"",null===(y=x.metadata)||void 0===y?void 0:y.text);case F.ReviewTitle:return z(u,(null===(B=x.metadata)||void 0===B?void 0:B.sourceLanguage)||"",null===(r=x.metadata)||void 0===r?void 0:r.title);case F.ProfileBadge:return f(u,v.mediaGroup.contributorRelationships);case F.Rating:var E=null===(w=x.metadata)||void 0===w?void 0:w.rating;void 0===E&&(E=0);return g.__spread(h(F.Rating,"^a-star-.*","a-star-"+E),f(F.Rating,E+" "+(1<E?q:n),"span"));case F.MainMedia:return t(v);case F.ProfileBlock:return w=
(w=v.mediaGroup.contributor.profile)?g.__spread(f(F.ProfileBlock,w.name,".a-profile-name"),l(F.ProfileBlock,{src:w.avatarUrl.desktop},".a-profile-avatar > img"),l(F.ProfileBlock,{href:null!==(E=w.link)&&void 0!==E?E:"javascript:void(0)"},"a.a-profile")):[],w;case F.ImageThumbnailsBlock:return p(v);case F.SingleReviewMediaBlock:return l(u,(D={},D[L.DATA_CSA_SLOT_ID]=c+"_"+v.reviewId+"_"+v.reviewRank,D));default:return[]}};return{updateReview:function(u){var v=e(u.mediaId,u.mediaGroup),x=Object.keys(F).flatMap(function(D){return C(F[D],
u,v)});Va(a,x)},updateReviewMedia:function(u){var v=e(u.mediaId,u.mediaGroup),x=Object.keys(mb).flatMap(function(D){return C(mb[D],u,v)});Va(a,x)},updateMedia:function(u){u=g.__spread(l(F.ImageThumbnailsBlock,{"aria-pressed":"false"},"._Y3Itb_media-popover-thumbnail-image-view-active_2W42O"),l(F.ImageThumbnailsBlock,{"aria-pressed":"true"},'button[data-mediaid="'+u+'"]'),h(F.ImageThumbnailsBlock,"_Y3Itb_media-popover-thumbnail-image-view-active_2W42O",void 0,"._Y3Itb_media-popover-thumbnail-image-view-active_2W42O"),
h(F.ImageThumbnailsBlock,void 0,"_Y3Itb_media-popover-thumbnail-image-view-active_2W42O",'button[data-mediaid="'+u+'"]'),h(F.MainMedia,"_Y3Itb_media-popover-image-view-active_2lj7U",void 0,"._Y3Itb_media-popover-image-view-active_2lj7U"),h(F.MainMedia,void 0,"_Y3Itb_media-popover-image-view-active_2lj7U",'div[data-mediaid="'+u+'"]'));Va(a,u)},updateSingleReviewContent:function(u){var v=Ua(a,F.SingleReviewComponent);v&&v.firstChild&&v.replaceChild(u,v.firstChild)}}},Wa=function(a,b){if(!a)return!1;
b=b.some(function(c){return a.classList.contains(c)});return a.offsetHeight<a.scrollHeight&&b},Tb=function(a){var b=["_Y3Itb_cr-sidepanel-truncated-text_3nfmo","_Y3Itb_cr-sidepanel-truncated-title_2w0Qj"],c=O(a,"_Y3Itb_cr-media-popover-sidepanel-header-section_3TxI7"),d=O(c,"_Y3Itb_cr-sidepanel-text_3MYCz"),e=O(c,"_Y3Itb_cr-sidepanel-title_EX93d"),f=O(c,"_Y3Itb_cr-sidepanel-expander-see-more_1sipE"),h=O(c,"_Y3Itb_cr-sidepanel-expander-see-less_1Hpji"),l=O(c,"_Y3Itb_cr-sidepanel-container-gradient_1zm2j"),
m=function(n){Wa(n,b)&&(A(f,function(C){return M(C)}),A(l,function(C){return lb("_Y3Itb_cr-sidepanel-container-gradient-truncated_3zXR9",C)}))},t=new ResizeObserver(function(n){var C;try{for(var u=g.__values(n),v=u.next();!v.done;v=u.next())m(v.value.target)}catch(D){var x={error:D}}finally{try{v&&!v.done&&(C=u.return)&&C.call(u)}finally{if(x)throw x.error;}}});A(d,function(n){t.observe(ea.unscope(n))});A(e,function(n){t.observe(ea.unscope(n))});var p=function(){k(!0);A(f,function(n){return I(n)});
A(h,function(n){return M(n)})},z=function(){k(!1);A(h,function(n){return I(n)})},k=function(n){q("_Y3Itb_cr-media-popover-sidepanel-header-section-truncated_DITiq",n,c);q("_Y3Itb_cr-sidepanel-container-gradient-truncated_3zXR9",n,l);q("_Y3Itb_cr-sidepanel-truncated-text_3nfmo",n,d);q("_Y3Itb_cr-sidepanel-truncated-title_2w0Qj",n,e)},q=function(n,C,u){C?A(u,function(v){return kb(n,v)}):A(u,function(v){return lb(n,v)})};return{toggleText:function(){d&&Wa(d,b)||e&&Wa(e,b)?p():z()},hideText:z,expandText:p,
initialize:function(){A(f,function(n){return I(n)});A(l,function(n){return kb("_Y3Itb_cr-sidepanel-container-gradient-truncated_3zXR9",n)});m(d);m(e)}}},Xa=function(){function a(b){this.actionButtons=b}a.getActionButtonsContainer=function(b){var c=V["default"].cardRoot.ownerDocument.getElementsByClassName("_Y3Itb_cr-vote-report-buttons-container_1YjZZ");return Array.from(c).filter(function(d){return d.dataset.id===b})[0]};a.prototype.likeButtonClicked=function(){var b=this.actionButtons.querySelectorAll("div[data-variant='like']")[0],
c=this.actionButtons.querySelectorAll("div[data-variant='like-done']")[0];I(b);M(c)};a.prototype.resetLike=function(){var b=this.actionButtons.querySelectorAll("div[data-variant='like']")[0],c=this.actionButtons.querySelectorAll("div[data-variant='like-done']")[0];I(c);M(b)};return a}(),Ub={dataStrategy:"inline",activate:"onclick",position:"triggerVertical"},Vb=function(a){var b;return{openTooltipPopover:function(c){return g.__awaiter(void 0,void 0,void 0,function(){var d,e,f;return g.__generator(this,
function(h){switch(h.label){case 0:if(b)return[3,2];d="reportAbusePreload_"+a;e=O(c,"_Y3Itb_cr-report-abuse-preload-content_ve26F");null===e||void 0===e?void 0:e.classList.remove("aok-hidden");f=g.__assign(g.__assign({},Ub),{name:d,content:e});return e?[4,Qb.get(d,e,c,f)]:[3,2];case 1:b=h.sent(),h.label=2;case 2:return b&&b.show(),[2]}})})},closeTooltipPopover:function(){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(c){b&&b.hide();return[2]})})},isOpen:function(){return b?
b.isOpen():!1}}},Wb=function(a){var b=(a=O(a,"_Y3Itb_cr-vote-report-buttons-container_1YjZZ"))?new Xa(a):void 0,c=new Set;return{initialize:function(d){c.has(d)?null===b||void 0===b?void 0:b.likeButtonClicked():null===b||void 0===b?void 0:b.resetLike()},addReviewId:function(d){null===b||void 0===b?void 0:b.likeButtonClicked();c.add(d)}}},Xb=function(a,b){var c=O(a,"_Y3Itb_left-icon-container_31i2O"),d=O(a,"_Y3Itb_right-icon-container_3Qopb");return{initialize:function(e,f){A(c,M);A(d,M);b.isFirstMediaItem(e,
f)&&A(c,I);b.isLastMediaItem(e,f)&&A(d,I)},hideButtons:function(){A(c,I);A(d,I)}}},Yb=function(a,b,c){a=O(a,"_Y3Itb_modal-content-container_XXRsT");var d=O(a,"_Y3Itb_cr-action-buttons-container_3vmwq"),e=Xb(a,b),f=Vb(c);if(!a)throw Error("modalContent element was not found");return{reportAbuse:g.__assign({},f),helpfulVote:g.__assign({},Wb(a)),navigation:g.__assign({},e),toggleMediaButtonsVisibility:function(h,l,m){if(h){if(!l||!m)throw Error("reviewId or mediaId not found: "+l+", "+m);A(d,M);e.initialize(l,
m)}else f.isOpen()||(A(d,I),e.hideButtons())}}},sa=function(){function a(b,c){var d;this.toastBar=c?a.getToastBarByNameIn(b,c):a.getToastBarByName(b);this.button=null===(d=this.toastBar)||void 0===d?void 0:d.getElementsByClassName("_Y3Itb_toast-bar-button_1yIpW")[0]}a.getToastBarByName=function(b){return V["default"].cardRoot.ownerDocument.querySelector("div[data-toast-bar-name='"+b+"']")};a.getToastBarByNameIn=function(b,c){return Ea(c,"div[data-toast-bar-name='"+b+"']")};a.prototype.setClickParams=
function(b){var c=this;b.forEach(function(d,e){var f;null===(f=c.button)||void 0===f?void 0:f.setAttribute(e,d)})};a.prototype.show=function(){A(this.toastBar,M)};a.prototype.hide=function(){A(this.toastBar,I)};return a}(),ac=function(a,b,c,d){setTimeout(function(){var e=d.parentElement,f=null===e||void 0===e?void 0:e.parentElement;if(e=null===f||void 0===f?void 0:f.offsetHeight){var h=d.offsetHeight;h=(f=null===f||void 0===f?void 0:f.querySelector('[data-reviewbind="ImageThumbnailsBlock"]'))?Math.max(e-
h+100-f.offsetHeight-8-22,100):Math.max(e-h+100-88-22,100)}else h=100;e=Zb(a,b,h);if((f=a.querySelector(".a-cardui-body .a-reactive-container"))&&f.scrollHeight>=h){f.style.height=h+"px";h=b.querySelector(".a-expander-icon");if(f=b.querySelector(".a-see-more-text")){f.style.display="none";a.setAttribute("data-a-expanded","false");if(c){var l=c.querySelector(".a-reactive-container");l&&(l.className="a-reactive-container a-reactive-container-transition")}b.style.opacity="1";b.style.display="block";
f.style.display="inline";h&&(h=h.querySelector(".a-css-icon"))&&(h.className="a-css-icon a-css-icon-draw a-css-icon-expand")}$b(a,b,e)}else a.setAttribute("data-a-expanded","true"),b&&b.remove(),f&&(e=f.querySelector(".a-reactive-container-gradient"))&&e.remove()},0)},Zb=function(a,b,c){return function(d){var e=a.querySelector(".a-cardui-body .a-reactive-container");e&&(e.style.transition="height 200ms linear",e.style.height=d?e.scrollHeight+"px":c+"px");a.setAttribute("data-a-expanded",d?"true":
"false");if(e=b.querySelector(".a-css-icon"))e.className=d?"a-css-icon a-css-icon-draw a-css-icon-collapse":"a-css-icon a-css-icon-draw a-css-icon-expand";e=b.querySelector(".a-see-more-text");var f=b.querySelector(".a-see-less-text");e&&f&&(e.style.display=d?"none":"inline",f.style.display=d?"inline":"none")}},$b=function(a,b,c){(b=b.querySelector(".a-cardui-expand-control-footer-button"))&&b.addEventListener("click",function(){var d="true"===a.getAttribute("data-a-expanded");c(!d)})},cc=function(a,
b,c,d){var e=Sb(b,a),f=Tb(b),h=Yb(b,c,a),l=new sa(L.THANKYOU_MESSAGE_TOAST_BAR_NAME,b),m=new sa(L.ERROR_MESSAGE_TOAST_BAR_NAME,b),t=fa["default"].setup(["reportAbuse"]),p=fa["default"].setup(["helpful"]),z=fa["default"].setup(["renderSingleReview"]),k={},q=new Map,n=function(B,r){A(B,function(w){k.reviewId=w});A(r,function(w){k.mediaId=w})},C=function(B,r){B=r[B];return a===G.IMAGE?B.image.physicalId:B.video.physicalId},u=function(B){return B.map(function(r){return r.mediaType===G.IMAGE?r.image:r.video}).findIndex(function(r){return(null===
r||void 0===r?void 0:r.physicalId)===k.mediaId})},v=function(){return g.__awaiter(void 0,void 0,void 0,function(){var B;return g.__generator(this,function(r){switch(r.label){case 0:if(!k.reviewId||!k.mediaId)throw Error("No reviewId present: "+k);return[4,c.fetchNextReview(k.reviewId)];case 1:return(B=r.sent())?[4,x(C(0,B.mediaGroup.mediaList),B.mediaGroup.id)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},x=function(B,r){return g.__awaiter(void 0,void 0,void 0,function(){var w,E;return g.__generator(this,
function(Q){switch(Q.label){case 0:return[4,c.fetchReview(r)];case 1:w=Q.sent();if(!w)throw Error("review was not fetched: "+r);E={reviewId:r,mediaId:B,reviewRank:w.reviewRank,mediaGroup:w.mediaGroup};return d?[4,D(w)]:[3,3];case 2:return Q.sent(),e.updateReviewMedia(E),[3,4];case 3:e.updateReview(E),Q.label=4;case 4:return n(r,B),f.hideText(),f.initialize(),h.helpfulVote.initialize(r),h.navigation.initialize(r,B),[2]}})})},D=function(B){return g.__awaiter(void 0,void 0,void 0,function(){var r,w,
E,Q,S,ja,va;return g.__generator(this,function(la){switch(la.label){case 0:return r=b.querySelector("div[data-reviewid]"),w=null===(va=null===(ja=B.mediaGroup.mediaList.at(0))||void 0===ja?void 0:ja.metadata)||void 0===va?void 0:va.review,E={isMshop:"true"===r.dataset.ismshop,locale:r.dataset.locale||"",marketplaceId:r.dataset.marketplaceid||"",isKindleApp:"true"===r.dataset.iskindleapp,localeLanguageName:r.dataset.localelanguagename||void 0,csrfT:r.dataset.csrft||"",isCustomerRecognized:"true"===
r.dataset.iscustomerrecognized,isAndroidApp:"true"===r.dataset.isandroidapp,isIosApp:"true"===r.dataset.isiosapp,isMobile:!1,lazyLoading:!1,isSingleReviewFromSharedLibraryEnabled:!0,imageProfileLazyLoading:!1,isModalView:!0},w&&E?[4,J(w,E)]:[3,2];case 1:Q=la.sent();var ka=Q;if(ka){var aa=ka.querySelector('[data-a-card-type="peekExpand"]');if(aa){var bc=aa.querySelector(".a-cardui-body"),pb=aa.querySelector(".a-cardui-expand-control-footer"),Ya=aa.querySelector(".a-cardui-footer");aa.style.marginTop=
"0px";Ya&&(Ya.style.padding="0px",Ya.style.paddingTop="0px");pb&&ac(aa,pb,bc,ka)}}S=ka;S&&q.set(w.id,S.cloneNode(!0));e.updateSingleReviewContent(Q);la.label=2;case 2:return[2]}})})},J=function(B,r){return g.__awaiter(void 0,void 0,void 0,function(){var w,E,Q,S;return g.__generator(this,function(ja){switch(ja.label){case 0:w=B.id;if(q.has(w))return[2,q.get(w).cloneNode(!0)];E={review:B,requestContext:r};S=ea.unscope;return[4,z.renderSingleReview(E)];case 1:return Q=S.apply(void 0,[ja.sent()]),[2,
Q]}})})},y=function(B){if(!k.reviewId)throw Error("no reviewId found while updating media: "+k.mediaId);e.updateMedia(B);n(k.reviewId,B);h.navigation.initialize(k.reviewId,B)};return{show:function(){return A(b,M)},hide:function(){return A(b,I)},update:function(B){var r=B.mediaId,w=B.reviewId;return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(E){switch(E.label){case 0:if(!r||!w)throw Error("reviewId or mediaId not found: "+w+", "+r);return[4,x(r,w)];case 1:return E.sent(),
[2]}})})},updateMedia:y,handleModalMediaProgressionClick:function(B){return g.__awaiter(void 0,void 0,void 0,function(){var r,w,E,Q;return g.__generator(this,function(S){switch(S.label){case 0:if(!k.reviewId||!k.mediaId)throw Error("No reviewId or mediaId present: "+k);r=c.getReviewById(k.reviewId);w=u(r.mediaList);E=B;switch(E){case W.RIGHT:return[3,1];case W.LEFT:return[3,5]}return[3,10];case 1:if(!(w<r.mediaList.length-1))return[3,2];y(C(w+1,r.mediaList));return[3,4];case 2:return[4,v()];case 3:S.sent(),
S.label=4;case 4:return[3,10];case 5:if(!(0<w))return[3,6];y(C(w-1,r.mediaList));return[3,9];case 6:return[4,c.fetchPreviousReview(k.reviewId)];case 7:return(Q=S.sent())?[4,x(C(Q.mediaGroup.mediaList.length-1,Q.mediaGroup.mediaList),Q.mediaGroup.id)]:[3,9];case 8:S.sent(),S.label=9;case 9:return[3,10];case 10:return[2]}})})},handleExpanderClick:function(B){switch(B){case ua.EXPAND:f.expandText();break;case ua.HIDE:f.hideText()}},handleReportAbuseClick:function(B){return g.__awaiter(void 0,void 0,
void 0,function(){var r,w;return g.__generator(this,function(E){switch(E.label){case 0:if(!k.reviewId)throw Error("no reviewId found while reporting abuse: "+k);h.reportAbuse.closeTooltipPopover();E.label=1;case 1:return E.trys.push([1,5,,6]),[4,t.reportAbuse({reviewId:k.reviewId,asin:B,domain:xa()})];case 2:r=E.sent();if(!r.success&&r.redirectUrl)return da["default"].setLocation(r.redirectUrl),[2];if(!r.success)return[3,4];l.show();return[4,v()];case 3:return E.sent(),[2];case 4:return r.success?
[3,6]:(m.show(),[2]);case 5:throw w=E.sent(),m.show(),w;case 6:return[2]}})})},handleHelpulVoteClick:function(B){return g.__awaiter(void 0,void 0,void 0,function(){var r,w;return g.__generator(this,function(E){switch(E.label){case 0:if(!k.reviewId)throw Error("no reviewId found while handling helpfulvote call: "+k);E.label=1;case 1:return E.trys.push([1,3,,4]),[4,p.helpful({reviewId:k.reviewId,domain:xa(),asin:B})];case 2:return r=E.sent(),!r.success&&r.redirectUrl&&da["default"].setLocation(r.redirectUrl),
r.success?(h.helpfulVote.addReviewId(k.reviewId),[2]):r.success?[3,4]:(m.show(),[2]);case 3:throw w=E.sent(),m.show(),w;case 4:return[2]}})})},openReportAbuseTooltip:h.reportAbuse.openTooltipPopover,toggleMediaButtonsVisibility:function(B){h.toggleMediaButtonsVisibility(B,k.reviewId,k.mediaId)},getCurrentReviewDetails:function(){return k},updateReviewDetails:n,renderSingleReviewFromSharedLibrary:D}},dc=R["default"].setup(),ec=function(a){var b=0,c=function(l,m,t){var p;return p={},p[L.DATA_MEDIA_ID]=
l,p[L.DATA_MEDIATYPE]=t,p[L.DATA_REVIEW_ID]=m,p[L.DATA_SHOW_GALLERY_IN_MODAL]="false",p},d=function(l){var m;return m={},m[L.DATA_CSA_C_TYPE]="element",m[L.DATA_CSA_SLOT_ID]=l,m},e=function(l){return[{tag:"img",elementAttributes:{src:l.thumbnailUrl,alt:l.altText}}]},f=function(l,m){var t={tag:"img",elementAttributes:{src:l.thumbnailUrl,alt:l.altText}};return m?[t,{tag:"div",elementAttributes:{class:"_Y3Itb_media-gallery-item-video-overlay-container_RHWdX"},children:[{tag:"div",elementAttributes:{class:"_Y3Itb_media-gallery-item-video-overlay_cGzRu"},
children:[{tag:"i",elementAttributes:{"class":"a-icon a-icon-star-mini a-star-mini-"+m.rating}},{tag:"span",textContent:"\u25b7 "+l.videoDuration}]}]}]:[t]},h=function(l,m,t,p,z){return l.map(function(k,q){var n,C=k.mediaType==Ja.IMAGE?k.image:k.video;if(C){var u=k.mediaType==Ja.IMAGE?e(k.image):f(k.video,k.metadata),v=null===(n=k.metadata)||void 0===n?void 0:n.contributionId;if(v)return{tag:"button",elementAttributes:g.__assign(g.__assign({class:k.mediaType==Ja.IMAGE?"_Y3Itb_media-gallery-item_3LROo":
"_Y3Itb_media-gallery-item-video_1k9yY"},c(C.physicalId,v,k.mediaType)),d(z+"_"+v+"_"+C.physicalId+"_"+p)),observer:q==m?t:void 0,children:g.__spread(u),clickHandler:function(x){return dc.attach(X.galleryItemClickHandler,x)}}}}).filter(function(k){return void 0!==k})};return{updateGallery:function(l,m,t,p){l=h(l,m,t,b,p);b++;0<l.length&&ob(a,{type:T.APPEND_ELEMENT,key:F.GalleryBlock,elements:l})}}},fc=function(a,b,c){var d=O(b,"_Y3Itb_media-popover-gallery-container-grid_mLjpJ"),e=O(b,"_Y3Itb_gallery-spinner_34BcK"),
f=a===G.IMAGE?"cm_cr_image_gallery_popover":"cm_cr_video_gallery_popover",h=new IntersectionObserver(function(p,z){p.forEach(function(k){return g.__awaiter(void 0,void 0,void 0,function(){var q;return g.__generator(this,function(n){switch(n.label){case 0:if(!k.isIntersecting)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),A(e,M),[4,c.fetchReviewsNextPage()];case 2:return n.sent(),t(),A(e,I),z.unobserve(k.target),[3,4];case 3:throw q=n.sent(),q;case 4:return[2]}})})})},{root:ea.unscope(d),
rootMargin:"0px",threshold:.25}),l=ec(d),m=0,t=function(){for(var p=c.getAllReviews(),z=c.getAllReviewIds(),k=[],q=m;q<z.length;q++)k.push.apply(k,g.__spread(p[z[q]].mediaList)),m++;l.updateGallery(k,5<=k.length?k.length-5:-1,h,f)};return{hide:function(){return A(b,I)},show:function(){return A(b,M)},update:function(){return g.__awaiter(void 0,void 0,void 0,function(){var p;return g.__generator(this,function(z){switch(z.label){case 0:return p=c.getAllReviewIds(),0!=p.length?[3,2]:[4,c.fetchReviewsNextPage()];
case 1:z.sent(),z.label=2;case 2:return t(),[2]}})})},scrollToMediaId:function(p){p&&(p=Ea(b,'div[data-mediaid="'+p+'"]'),A(p,function(z){return z.scrollIntoView()}))}}},gc=function(a){var b=O(a,"_Y3Itb_media-popover-see-all-container_1Lmmi");return{show:function(){return A(b,function(c){return M(c)})},hide:function(){return A(b,function(c){return I(c)})}}},hc=function(a,b){var c=[],d={},e,f,h=function(){return g.__awaiter(void 0,void 0,void 0,function(){var k,q;return g.__generator(this,function(n){switch(n.label){case 0:return k=
ta.setup(["getGroupedMediaReviews"]),[4,k.getGroupedMediaReviews({asin:a,nextToken:e,mediaType:b,limit:50})];case 1:return q=n.sent(),l(q.mediaGroupList),e=q.nextToken,[2]}})})},l=function(k){k.forEach(function(q){d[q.id]=q;0>c.indexOf(q.id)&&c.push(q.id)})},m=function(k){return!!d[k]},t=function(k){return c.indexOf(k)},p=function(){return g.__awaiter(void 0,void 0,void 0,function(){var k;return g.__generator(this,function(q){switch(q.label){case 0:k=0===Object.keys(d).length;if(!k&&(k||f||!e))return[3,
5];q.label=1;case 1:return q.trys.push([1,,3,4]),[4,h()];case 2:return q.sent(),[3,4];case 3:return f=!1,[7];case 4:return[2,!0];case 5:return[2,!1]}})})},z=function(k,q){return d[k].mediaList.map(function(n){return n.mediaType===G.IMAGE?n.image:n.video}).findIndex(function(n){return(null===n||void 0===n?void 0:n.physicalId)===q})};return{fetchReview:function(k){return g.__awaiter(void 0,void 0,void 0,function(){var q,n,C,u;return g.__generator(this,function(v){switch(v.label){case 0:if(!k)throw Error("fetchReview was called without a reviewId");
q=m(k);v.label=1;case 1:return q?[3,3]:[4,p()];case 2:return n=v.sent(),q=m(k),n?[3,1]:[3,3];case 3:if(m(k))return[3,5];C=ta.setup(["getMediaGroup"]);return[4,C.getMediaGroup({reviewId:k})];case 4:u=v.sent(),l(u),e="",N.logCounter("desktop.missingReviewId",1),v.label=5;case 5:return m(k)?[2,{mediaGroup:d[k],reviewRank:t(k)}]:[2]}})})},isReviewFetched:m,fetchReviewsNextPage:p,fetchNextReview:function(k){return g.__awaiter(void 0,void 0,void 0,function(){var q,n;return g.__generator(this,function(C){switch(C.label){case 0:return q=
t(k)+1,q>=c.length?[4,p()]:[3,2];case 1:C.sent(),C.label=2;case 2:return n=c[q],m(n)?[2,{mediaGroup:d[n],reviewRank:q}]:[2]}})})},fetchPreviousReview:function(k){return g.__awaiter(void 0,void 0,void 0,function(){var q,n;return g.__generator(this,function(C){q=t(k)-1;if(0>q)return[2];n=c[q];return m(n)?[2,{mediaGroup:d[n],reviewRank:q}]:[2]})})},getReviewById:function(k){return d[k]},getReviewIndexById:t,getAllReviews:function(){return d},getAllReviewIds:function(){return c},isFirstMediaItem:function(k,
q){var n=t(k);k=z(k,q);return 0===n&&0===k},isLastMediaItem:function(k,q){var n=t(k);q=z(k,q);return!e&&n===c.length-1&&q===d[k].mediaList.length-1}}},Ba=function(){var a={};return{setData:function(b,c){a[b]=c},getData:function(b){return a[b]},hasData:function(b){return b in a},removeData:function(b){delete a[b]},clearData:function(){for(var b in a)a.hasOwnProperty(b)&&delete a[b]}}}(),ic=function(a,b,c,d,e){var f=hc(b,c),h=Rb(d),l=gc(d),m=new sa(L.LOADPOPOVER_ERROR_TOAST_BAR_NAME,d),t=O(d,"_Y3Itb_single-review-media-popover-container_1h9X2");
if(!t)throw Error("Unable to find singleReviewMediaPopoverContainer");var p=cc(c,t,f,e);d=O(d,"_Y3Itb_gallery-container_2pBFm");if(!d)throw Error("Unable to find mediaGalleryContainer");var z=fc(c,d,f);return{loadModal:function(k){return g.__awaiter(void 0,void 0,void 0,function(){var q;return g.__generator(this,function(n){switch(n.label){case 0:return m.hide(),p.hide(),z.hide(),h.show(),h.setLoadingAnimation(!0),k.popoverDetails.popover?[4,k.popoverDetails.popover.showSync()]:[3,2];case 1:n.sent(),
n.label=2;case 2:return n.trys.push([2,4,,5]),q=k.showGalleryInModal?z:p,[4,q.update(k)];case 3:return n.sent(),q.show(),k.showGalleryInModal?l.hide():l.show(),h.hide(),[3,5];case 4:n.sent();N.logCounter("desktop.popoverLoading.Error",1);h.setLoadingAnimation(!1);if(!k.mediaType||!k.asin)throw Error("mediaType or asin was not found while setting parameters for toastbar: "+k.mediaType+", "+k.asin);n=new Map([[L.DATA_POPOVER_NAME,k.popoverDetails.popoverName],[L.DATA_ASIN,k.asin],[L.DATA_MEDIATYPE,
k.mediaType.toString()]]);if(k.showGalleryInModal)n.set(L.DATA_SHOW_GALLERY_IN_MODAL,"true");else{if(!k.reviewId||!k.mediaId)throw Error("mediaId or reviewId was not found while setting parameters for toastbar: "+k.reviewId+", "+k.mediaId);n.set(L.DATA_REVIEW_ID,k.reviewId);n.set(L.DATA_MEDIA_ID,k.mediaId)}m.setClickParams(n);m.show();return[3,5];case 5:return[2]}})})},updateModalWithReview:function(k,q){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(n){switch(n.label){case 0:return z.hide(),
l.show(),[4,p.update({reviewId:k,mediaId:q,asin:b,mediaType:c})];case 1:return n.sent(),p.show(),[2]}})})},showMediaGallery:function(){return g.__awaiter(void 0,void 0,void 0,function(){var k;return g.__generator(this,function(q){switch(q.label){case 0:return k=p.getCurrentReviewDetails().mediaId,p.hide(),l.hide(),h.show(),h.setLoadingAnimation(!0),[4,z.update()];case 1:return q.sent(),h.hide(),z.show(),z.scrollToMediaId(k),[2]}})})},updateMediaInModal:p.updateMedia,handleModalMediaProgressionClick:p.handleModalMediaProgressionClick,
handleExpanderClick:p.handleExpanderClick,openReportAbuseDialog:p.openReportAbuseTooltip,handleReportAbuseClick:function(){return p.handleReportAbuseClick(b)},handleHelpulVoteClick:function(){return p.handleHelpulVoteClick(b)},closeModal:function(){return za.getPopoverByName(a).hide()}}},jc=function(a,b){return g.__awaiter(void 0,void 0,void 0,function(){var c;return g.__generator(this,function(d){switch(d.label){case 0:return c=fa["default"].setup(["triggerWeblab"]),[4,c.triggerWeblab({weblabId:a,
isCustomerIdBasedWeblab:b})];case 1:return[2,d.sent()]}})})},kc=function(){function a(){this.desktopPopoverModalOptions={dataStrategy:"preload",hideHeader:!0,closeButton:!0,padding:"none",name:"cr-media-popover"}}a.prototype.onVideoClickHandler=function(b){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(c){throw Error("Video click handler on Desktop is not yet implemented.");})})};a.prototype.onImageClickHandler=function(b){return g.__awaiter(this,void 0,void 0,
function(){return g.__generator(this,function(c){switch(c.label){case 0:return[4,this.showImagePopover(b,!1)];case 1:return c.sent(),[2]}})})};a.prototype.onSeeMoreClickHandler=function(b){var c;return g.__awaiter(this,void 0,void 0,function(){var d,e,f;return g.__generator(this,function(h){switch(h.label){case 0:return d=null===(c=b.currentTarget)||void 0===c?void 0:c.dataset,e=G[d.mediatype],f=Ha(e),f!==ia.IMAGE?[3,2]:[4,this.showImagePopover(b,!0)];case 1:return h.sent(),[3,3];case 2:throw N.logError("loadDesktopVideoGalleryError",
f),Error("Video gallery is not available on desktop.");case 3:return[2]}})})};a.prototype.showImagePopover=function(b,c){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(d){switch(d.label){case 0:return[4,this.openModal(b,c)];case 1:return d.sent(),[2]}})})};a.prototype.openModal=function(b,c){return g.__awaiter(this,void 0,void 0,function(){var d,e,f,h,l,m,t,p,z,k,q,n,C,u,v,x;return g.__generator(this,function(D){switch(D.label){case 0:d=b.currentTarget;e=jb(d);
if(c&&(!e.mediaType||!e.asin))throw Error("media props are missing while trying to load the modal: "+JSON.stringify(e));if(!(c||e.mediaType&&e.asin&&e.reviewId&&e.mediaId))throw Error("media props are missing while trying to load the modal: "+JSON.stringify(e));f=e.mediaType===G.IMAGE?"_Y3Itb_cm_cr_image_popoversection_3iYPp":"_Y3Itb_cm_cr_video_popoversection_2v7yY";h=ya["default"].cardRoot.getElementsByClassName(f)[0];l=h.getElementsByClassName("_Y3Itb_media-popover-container_2BBbs")[0];m=this.desktopPopoverModalOptions.name+
"_"+e.mediaType;t=h.querySelector("div[data-reviewbind=SingleReviewMediaBlock]");p=(null===t||void 0===t?void 0:t.getAttribute("data-closebuttonaria"))||"";z=(null===t||void 0===t?void 0:t.getAttribute("data-modaltitlearia"))||"";q=k=!1;if(!l)return[3,2];(n=l.querySelector("div[data-reviewid]"))&&(q="true"===n.dataset.iscustomerrecognized);return q?[4,jc("COFEE_DD_MEDIA_CARDS_MIGRATION_SHARED_LIBRARY_1247512")]:[3,2];case 1:C=D.sent(),"T1"===C.treatment&&(k=!0),D.label=2;case 2:return u=g.__assign(g.__assign({},
this.desktopPopoverModalOptions),{name:m,closeButtonLabel:p,popoverLabel:z}),[4,Pb.get(m,l,d,u)];case 3:v=D.sent();x=Ba.hasData(e.mediaType)?Ba.getData(e.mediaType):ic(m,e.asin,e.mediaType,l,k);if(!x)throw Error("Could not load ModalManager for opening modal: "+e);return[4,x.loadModal({asin:e.asin,mediaId:e.mediaId,reviewId:e.reviewId,mediaType:e.mediaType,showGalleryInModal:c,popoverDetails:{popoverName:this.desktopPopoverModalOptions.name+"_"+e.mediaType,popover:v}})];case 4:return D.sent(),Ba.hasData(e.mediaType)||
Ba.setData(e.mediaType,x),v.updatePosition(),d.classList.remove("a-declarative"),[2]}})})};return a}(),fb=function(a,b){a=b?a+". Error object: "+JSON.stringify({message:b.message,name:b.name,stack:b.stack}):a;Bb.log(a,"FATAL")},ma;(function(a){a.CAROUSEL="crsl";a.IMAGES_CAROUSEL="crsl_img";a.VIDEOS_CAROUSEL="crsl_vid"})(ma||(ma={}));var na;(function(a){a.DETAIL_PAGE_WIDGET="dp";a.IMAGE_GALLERY="img";a.MEDIA_GALLERY="mg";a.OTHER="othr"})(na||(na={}));var oa;(function(a){a.SEE_MORE="sm";a.POPOVER="pop";
a.IMAGE="img";a.VIDEO="vid"})(oa||(oa={}));var pa;(function(a){a.DESKTOP="d";a.MOBILE_APP="ma";a.MOBILE_BROWSER="mb";a.TABLET_APP="ta";a.TABLET_BROWSER="tb";a.UNKNOWN="unkn"})(pa||(pa={}));var wa=function(){function a(b,c,d,e){this.page=b;this.device=c;this.widget=d;this.location=e}a.prototype.toString=function(){return a.PREFIX+a.DELIMITER+this.page+a.DELIMITER+this.device+a.DELIMITER+this.widget+a.DELIMITER+this.location};a.prototype.appendToString=function(b){return b?this.toString()+a.DELIMITER+
b:this.toString()};a.MAX_LENGTH=32;a.PREFIX="cm_cr";a.DELIMITER="_";return a}(),lc=new wa(na.DETAIL_PAGE_WIDGET,pa.MOBILE_APP,ma.CAROUSEL,oa.IMAGE),mc=new wa(na.DETAIL_PAGE_WIDGET,pa.MOBILE_APP,ma.CAROUSEL,oa.VIDEO),nc=new wa(na.DETAIL_PAGE_WIDGET,pa.MOBILE_APP,ma.IMAGES_CAROUSEL,oa.SEE_MORE),oc=new wa(na.DETAIL_PAGE_WIDGET,pa.MOBILE_APP,ma.VIDEOS_CAROUSEL,oa.SEE_MORE),pc=new wa(na.DETAIL_PAGE_WIDGET,pa.MOBILE_BROWSER,ma.IMAGES_CAROUSEL,oa.SEE_MORE),qc=new wa(na.DETAIL_PAGE_WIDGET,pa.MOBILE_BROWSER,
ma.CAROUSEL,oa.VIDEO),rc=function(){function a(){}a.prototype.onVideoClickHandler=function(b){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(c){switch(c.label){case 0:return[4,this.onMediaClickHandler(b)];case 1:return c.sent(),[2]}})})};a.prototype.onImageClickHandler=function(b){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(c){switch(c.label){case 0:return[4,this.onMediaClickHandler(b)];case 1:return c.sent(),[2]}})})};a.prototype.onSeeMoreClickHandler=
function(b){var c;return g.__awaiter(this,void 0,void 0,function(){var d,e,f;return g.__generator(this,function(h){switch(h.label){case 0:return d=null===(c=b.currentTarget)||void 0===c?void 0:c.dataset,e=G[d.mediatype],f=Ha(e),[4,this.goToGallery(b,f)];case 1:return h.sent(),[2]}})})};a.prototype.onMediaClickHandler=function(b){var c;return g.__awaiter(this,void 0,void 0,function(){var d,e,f,h,l;return g.__generator(this,function(m){switch(m.label){case 0:return d=null===(c=b.currentTarget)||void 0===
c?void 0:c.dataset,e=G[d.mediatype],f=d.rank,h={reviewId:d.reviewid,mediaType:e,url:d.url,thumbnailUrl:d.thumbnailurl,physicalId:d.physicalid,asin:d.asin,isSingleReview:!1,hidePivot:!1,refMarker:a.getIVXRefMarker(e,f),ingressType:"dpreviews",filter:e===G.IMAGE?"image":"video",metricsPrefix:e===G.IMAGE?"CarouselImageToAppX":"CarouselVideoToAppX"},[4,La()];case 1:return l=m.sent(),l.addEventListener("com.amazon.mshop.ivx1.closed.progressPositionAndMediaIdSend",function(){this.refocusToMedia(d.physicalId);
l.removeEventListener("com.amazon.mshop.ivx1.closed.progressPositionAndMediaIdSend")}),[4,Eb(l,h)];case 2:return m.sent(),[2]}})})};a.prototype.refocusToMedia=function(b){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(c){return[2,new Promise(function(d,e){var f=V["default"].cardRoot.ownerDocument.querySelector('button[data-physicalid="'+b+'"]');setTimeout(function(){null===f||void 0===f?void 0:f.focus();d()},0)})]})})};a.prototype.goToGallery=function(b,c){var d;
return g.__awaiter(this,void 0,void 0,function(){var e,f,h,l;return g.__generator(this,function(m){switch(m.label){case 0:return e=null===(d=b.currentTarget)||void 0===d?void 0:d.dataset,f=e.asin,h=c===ia.IMAGE?nc:oc,[4,La()];case 1:return l=m.sent(),l.navigate({url:eb(h.toString(),c,f),successCallback:function(){N.logNoError("loadMediaGalleryError",c)},failCallback:function(t){fb("Failed to load gallery for asin: "+f+".",t);N.logError("loadMediaGalleryError",c)}}),[2]}})})};a.getIVXRefMarker=function(b,
c){return(b===G.IMAGE?lc:mc).appendToString(c)};return a}(),U=function(){function a(b){var c=this;this.popover=b;this.loadMediaResources=function(){for(var d=c.popover.querySelectorAll("[data-lazyimagesource]"),e=0;e<d.length;e++){var f=d[e],h=f.getAttribute("data-lazyimagesource");f="img"===f.tagName.toLowerCase()?f:f.getElementsByTagName("img")[0];f.getAttribute("src")!=h&&f.setAttribute("src",h)}};this.getCurrentMediaIndex=function(){for(var d=c.popover.querySelectorAll("[data-mediaid]"),e=0;e<
d.length;e++)if("none"!==d[e].style.display)return e;return 0};this.getPreviousPopoverWidget=function(){return c.popover.previousElementSibling?new a(c.popover.previousElementSibling):null};this.getNextPopoverWidget=function(){return c.popover.nextElementSibling?new a(c.popover.nextElementSibling):null};this.getNumbersOfMedia=function(){return c.popover.querySelectorAll("[data-mediaid]").length};this.toggleOverlay=function(){var d=c.popover.getElementsByClassName("_Y3Itb_overlay-content-container_1ubFP")[0];
d.classList.contains("_Y3Itb_media-popover-overlay-fade-out_1eneO")?(d.classList.remove("_Y3Itb_media-popover-overlay-fade-out_1eneO"),d.classList.add("_Y3Itb_media-popover-overlay-fade-in_bZzwP")):(d.classList.add("_Y3Itb_media-popover-overlay-fade-out_1eneO"),d.classList.remove("_Y3Itb_media-popover-overlay-fade-in_bZzwP"))};this.scrollIntoSelf=function(){c.popover.scrollIntoView()};this.scrollIntoMediaByIndex=function(d){c.scrollIntoSelf();var e=!1;c.popover.querySelectorAll("[data-mediaid]").forEach(function(f,
h){e?c.removeHighlightPageIndicator(h):c.addHighlightPageIndicator(h);h==d?(M(f),e=!0):I(f)})};this.scrollIntoMediaId=function(d){c.scrollIntoSelf();c.popover.querySelectorAll("[data-mediaid]").forEach(function(e,f){e.getAttribute("data-mediaid")===d&&c.scrollIntoMediaByIndex(f)})};this.getReviewId=function(){return c.popover.getAttribute("data-reviewid")};this.getPageIndicator=function(d){var e=c.popover.getElementsByClassName("_Y3Itb_media-popover-page-indicator_36NFP")[0];if(e)return e.childNodes[d]};
this.addHighlightPageIndicator=function(d){d=c.getPageIndicator(d);null===d||void 0===d?void 0:d.classList.add("_Y3Itb_highlighted_1QxVg")};this.removeHighlightPageIndicator=function(d){d=c.getPageIndicator(d);null===d||void 0===d?void 0:d.classList.remove("_Y3Itb_highlighted_1QxVg")}}a.getPopoverWidgetById=function(b){return b?V["default"].cardRoot.ownerDocument.getElementsByClassName("_Y3Itb_media-popover-list-container_3mcnh")[0].querySelector("div[data-reviewid='"+b+"']"):null};a.prototype.handlePopoverClick=
function(b){switch(b){case W.LEFT:if(0<this.getCurrentMediaIndex())this.scrollIntoMediaByIndex(this.getCurrentMediaIndex()-1);else if(b=this.getPreviousPopoverWidget())b.scrollIntoSelf(),b.scrollIntoMediaByIndex(b.getNumbersOfMedia()-1);break;case W.CENTER:this.toggleOverlay();break;case W.RIGHT:if(this.getCurrentMediaIndex()<this.getNumbersOfMedia()-1)this.scrollIntoMediaByIndex(this.getCurrentMediaIndex()+1);else if(b=this.getNextPopoverWidget())b.scrollIntoSelf(),b.scrollIntoMediaByIndex(0)}};
a.prototype.scrollIntoNextPopover=function(){var b=this.getNextPopoverWidget()||this.getPreviousPopoverWidget();b&&b.scrollIntoSelf()};return a}(),ba;(function(a){a.closePopoverClickHandler="ClosePopoverClickHandler";a.popoverClickHandler="PopoverClickHandler";a.desktopLeftClickHandler="DesktopLeftClickHandler";a.desktopRightClickHandler="DesktopRightClickHandler";a.openReportConfirmationDialogClickHandler="OpenReportConfirmationDialogClickHandler";a.helpfulVoteClickHandler="HelpfulVoteClickHandler";
a.confirmReportAbuseClickHandler="ConfirmReportAbuseClickHandler";a.noopHandler="noopHandler";a.loadMediaPopover="loadMediaPopover";a.closePopoverErrorDialogClickHandler="ClosePopoverErrorDialogClickHandler"})(ba||(ba={}));var sc=function(){function a(b){this.popover=b;b=b.getElementsByClassName("_Y3Itb_cr-popover-overlay-text-container_NfghQ")[0];this.text=b.querySelector("._Y3Itb_cr-text_28H9k");this.title=b.querySelector("._Y3Itb_cr-title_3bWqW");this.expandButton=b.querySelector("._Y3Itb_cr-text-expand-button_2BWKW");
this.hideButton=b.querySelector("._Y3Itb_cr-text-hide-button_2qNi2")}a.prototype.toggleElementExpansion=function(b,c){c?(b.classList.remove("_Y3Itb_truncated_j_-Jw"),b.classList.add("_Y3Itb_expanded_2wQ4c")):(b.classList.remove("_Y3Itb_expanded_2wQ4c"),b.classList.add("_Y3Itb_truncated_j_-Jw"))};a.prototype.initResizeObserver=function(){var b=this;if(this.title||this.text)this.observer=new ResizeObserver(function(c){var d;try{for(var e=g.__values(c),f=e.next();!f.done;f=e.next())a.isTruncated(f.value.target,
"_Y3Itb_truncated_j_-Jw")&&M(b.expandButton)}catch(l){var h={error:l}}finally{try{f&&!f.done&&(d=e.return)&&d.call(e)}finally{if(h)throw h.error;}}}),this.title&&this.observer.observe(this.title),this.text&&this.observer.observe(this.text)};a.prototype.expandText=function(){this.text&&a.isTruncated(this.text,"_Y3Itb_truncated_j_-Jw")&&this.toggleElementExpansion(this.text,!0);this.title&&a.isTruncated(this.title,"_Y3Itb_truncated_j_-Jw")&&this.title.classList.remove("_Y3Itb_truncated_j_-Jw");I(this.expandButton);
M(this.hideButton);this.setPopoverOverlayGradient(!0);this.showActionButtons(!1)};a.prototype.toggleText=function(){this.text&&a.isTruncated(this.text,"_Y3Itb_truncated_j_-Jw")||this.title&&a.isTruncated(this.title,"_Y3Itb_truncated_j_-Jw")?this.expandText():this.hideText()};a.prototype.hideText=function(){this.text&&(this.text.offsetHeight<this.text.scrollHeight&&(this.text.scrollTop=0),this.toggleElementExpansion(this.text,!1));this.title&&this.title.classList.add("_Y3Itb_truncated_j_-Jw");I(this.hideButton);
this.setPopoverOverlayGradient(!1);this.showActionButtons(!0)};a.prototype.setPopoverOverlayGradient=function(b){var c=this.popover.getElementsByClassName("_Y3Itb_cr-media-popover-overlay-container_32qUq")[0];c&&(b?(c.classList.add("_Y3Itb_popover-overlay-gradient_114MI"),c.dataset.mixOperations=ba.noopHandler):c.classList.contains("_Y3Itb_popover-overlay-gradient_114MI")&&(c.classList.remove("_Y3Itb_popover-overlay-gradient_114MI"),c.dataset.mixOperations&&delete c.dataset.mixOperations))};a.prototype.showActionButtons=
function(b){var c=this.popover.getElementsByClassName("_Y3Itb_cr-action-buttons-container_28a_m")[0];c&&(b?M(c):I(c))};a.isTruncated=function(b,c){return b&&b.offsetHeight<b.scrollHeight&&b.classList.contains(c)};return a}(),Za=function(a){if(a)return(null===a||void 0===a?0:a.getElementsByClassName("_Y3Itb_cr-popover-overlay-text-container_NfghQ")[0])?new sc(a):void 0},tc=function(){return function(){var a=this;this.show=function(){M(a.popoverList)};this.hide=function(){I(a.popoverList)};this.getNumberOfPopoversLoaded=
function(){return a.popoverList.childNodes.length};this.getNumberOfPopoversLeft=function(){if(a.currentReviewId){var b=0;a.popoverList.childNodes.forEach(function(c,d){c.getAttribute("data-reviewid")==a.currentReviewId&&(b=a.getNumberOfPopoversLoaded()-d)});return b}return a.popoverList.childNodes.length};this.addPopovers=function(b){b.querySelectorAll("._Y3Itb_media-popover-container_15D5F").forEach(function(c){c=ea.unscope(c);var d=c.getAttribute("data-reviewid");U.getPopoverWidgetById(d)||(a.popoverList.appendChild(c),
a.observer.observe(c),c=Za(U.getPopoverWidgetById(d)),null===c||void 0===c?void 0:c.initResizeObserver())})};this.scrollTo=function(b,c){a.setCurrentReviewId(b);b=U.getPopoverWidgetById(b);(new U(b)).scrollIntoMediaId(c)};this.setCurrentReviewId=function(b){a.currentReviewId=b};this.doesPopoverExists=function(b){return null!=U.getPopoverWidgetById(b)};this.getNextToken=function(){return a.popoverList.getAttribute("data-next-token")};this.setNextToken=function(b){return a.popoverList.setAttribute("data-next-token",
b)};this.setOnScrollCallback=function(b){a.onScrollCallback=b};this.popoverList=V["default"].cardRoot.ownerDocument.getElementsByClassName("_Y3Itb_media-popover-list-container_3mcnh")[0];this.observer=new IntersectionObserver(function(b){b.forEach(function(c){if(c.isIntersecting){c=new U(c.target);var d=c.getReviewId(),e=a.currentReviewId;a.setCurrentReviewId(d);if(a.onScrollCallback)a.onScrollCallback(d);c.loadMediaResources();c=Za(U.getPopoverWidgetById(e));null===c||void 0===c?void 0:c.hideText()}})},
{threshold:.5})}}(),Fa=function(){function a(){this.confirmationDialog=V["default"].cardRoot.ownerDocument.querySelector("._Y3Itb_media-popover-report-abuse-confirmation-dialog_7HNIt");this.confirmButton=V["default"].cardRoot.ownerDocument.querySelector("._Y3Itb_media-popover-report-abuse-confirmation-dialog-button_35f75")}a.prototype.setReviewId=function(b){this.confirmButton.dataset.id=b};a.prototype.setAsin=function(b){this.confirmButton.dataset.asin=b};a.prototype.show=function(){M(this.confirmationDialog)};
a.prototype.hide=function(){I(this.confirmationDialog)};return a}(),qb=function(){function a(){this.popoverSkeleton=V["default"].cardRoot.ownerDocument.getElementsByClassName("_Y3Itb_media-popover-skeleton-container_3DI7n")[0];this.profileSkeleton=this.popoverSkeleton.getElementsByClassName("_Y3Itb_profile-skeleton_1JfdD")[0]}a.prototype.show=function(){M(this.popoverSkeleton)};a.prototype.hide=function(){I(this.popoverSkeleton)};a.prototype.setLoadingAnimation=function(b){b?this.profileSkeleton.classList.add("_Y3Itb_loading_3908t"):
this.profileSkeleton.classList.contains("_Y3Itb_loading_3908t")&&this.profileSkeleton.classList.remove("_Y3Itb_loading_3908t")};return a}(),qa;(function(a){a[a.Popover=0]="Popover";a[a.Gallery=1]="Gallery";a[a.ReportAbuseConfirmationDialog=2]="ReportAbuseConfirmationDialog"})(qa||(qa={}));var Ca=function(){function a(){}a.getInstance=function(){a.instance||(a.instance=new a);return a.instance};a.prototype.initPopoverWidgetList=function(){null==this.popoverWidgetList&&(this.popoverWidgetList=new tc);
return this.popoverWidgetList};a.prototype.initPopoverSkeletonClient=function(){this.popoverSkeleton=new qb};a.prototype.initPopover=function(b){a.currentScreen=qa.Popover;a.popoverName=b;this.resetOverlayComponents();this.initPopoverWidgetList();this.initPopoverSkeletonClient()};a.prototype.loadMediaPopover=function(b){return g.__awaiter(this,void 0,void 0,function(){var c,d,e,f,h,l,m,t=this;return g.__generator(this,function(p){switch(p.label){case 0:return this.initPopover(b.popoverDetails.popoverName),
this.popoverSkeleton.show(),this.popoverWidgetList.hide(),this.popoverSkeleton.setLoadingAnimation(!0),b.popoverDetails.popover?[4,b.popoverDetails.popover.showSync()]:[3,2];case 1:p.sent(),p.label=2;case 2:c=this.popoverWidgetList.doesPopoverExists(b.reviewId),d=0,p.label=3;case 3:p.trys.push([3,9,,10]),p.label=4;case 4:if(c)return[3,6];e=0===d;return[4,this.fetchAnotherPopoversPage(b.asin,b.mediaType,e)];case 5:return f=p.sent(),c=this.popoverWidgetList.doesPopoverExists(b.reviewId),d++,f?[3,4]:
[3,6];case 6:if(c)return[3,8];h=ta.setup(["renderPopover"]);return[4,h.renderPopover({reviewId:b.reviewId})];case 7:l=p.sent(),this.popoverWidgetList.addPopovers(l),this.popoverWidgetList.setNextToken(""),c=!0,N.logCounter("mobileweb.missingReviewId",1),p.label=8;case 8:return this.popoverWidgetList.show(),c&&this.popoverWidgetList.scrollTo(b.reviewId,b.mediaId),this.popoverSkeleton.hide(),[3,10];case 9:return p.sent(),N.logCounter("mobile.popoverLoading.Error",1),this.popoverSkeleton.setLoadingAnimation(!1),
m=new sa("loadPopoverError"),m.setClickParams(new Map([["data-popovername",b.popoverDetails.popoverName],["data-asin",b.asin],["data-mediatype",b.mediaType.toString()],["data-reviewid",b.reviewId],["data-mediaid",b.mediaId]])),m.show(),[3,10];case 10:return this.popoverWidgetList.setOnScrollCallback(function(){5>=t.popoverWidgetList.getNumberOfPopoversLeft()&&t.fetchAnotherPopoversPage(b.asin,b.mediaType)}),[2]}})})};a.prototype.resetOverlayComponents=function(){(new Fa).hide();(new sa("loadPopoverError")).hide();
(new sa("reportAbuseThankYouMessage")).hide()};a.prototype.showReportAbuseConfirmationDialog=function(b,c){a.currentScreen=qa.ReportAbuseConfirmationDialog;var d=new Fa;d.setReviewId(b);d.setAsin(c);d.show()};a.prototype.back=function(){switch(a.currentScreen){case qa.Popover:case qa.Gallery:za.getPopoverByName(a.popoverName).hide();break;case qa.ReportAbuseConfirmationDialog:(new Fa).hide(),a.currentScreen=qa.Popover}};a.prototype.fetchAnotherPopoversPage=function(b,c,d){void 0===d&&(d=!1);return g.__awaiter(this,
void 0,void 0,function(){var e,f;return g.__generator(this,function(h){switch(h.label){case 0:e=this.popoverWidgetList.getNumberOfPopoversLoaded();f=this.popoverWidgetList.getNextToken();if(!(d||!this.isAlreadyLoadingMedia&&f&&500>=e))return[3,5];this.isAlreadyLoadingMedia=!0;h.label=1;case 1:return h.trys.push([1,,3,4]),[4,this.loadPopovers(b,c,f)];case 2:return h.sent(),[3,4];case 3:return this.isAlreadyLoadingMedia=!1,[7];case 4:return[2,!0];case 5:return[2,!1]}})})};a.prototype.loadPopovers=function(b,
c,d){return g.__awaiter(this,void 0,void 0,function(){var e,f;return g.__generator(this,function(h){switch(h.label){case 0:return e=ta.setup(["renderPopoverList"]),[4,e.renderPopoverList({asin:b,nextToken:d,mediaType:c,limit:50})];case 1:return f=h.sent(),this.popoverWidgetList.addPopovers(f),d=f.getAttribute("data-next-token"),this.popoverWidgetList.setNextToken(d),[2,d]}})})};return a}().getInstance(),uc=function(){function a(){}a.prototype.onVideoClickHandler=function(b){var c;return g.__awaiter(this,
void 0,void 0,function(){var d,e,f,h,l,m,t,p,z=this;return g.__generator(this,function(k){d=null===(c=b.currentTarget)||void 0===c?void 0:c.dataset;e=d.asin;f=d.physicalid;h=d.reviewid;l=d.extension;m=d.thumbnailurl;t=this.getRefMarker(d.rank);Ia["default"].trigger("a:declarative:reviews:open-mweb-immersive-video-modal:click",{$event:b.event,$target:b.currentTarget,data:{asin:e,filter:"video",isSingleReview:!0,mediaType:"video",metricsPrefix:"CarouselVideoToAppX",physicalId:f,refMarker:t,reviewId:h,
shouldTriggerRefTag:!0,slateImageUrl:m,url:"https://m.media-amazon.com/images/I/"+f+"."+l}});p=function(){z.refocusToMedia(f);Ia["default"].off("vse:ns:partialcomponents:vse_reviews_mobile:lightboxClosed",p)};Ia["default"].on("vse:ns:partialcomponents:vse_reviews_mobile:lightboxClosed",p);return[2]})})};a.prototype.refocusToMedia=function(b){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(c){return[2,new Promise(function(d,e){var f=V["default"].cardRoot.ownerDocument.querySelector('button[data-physicalid="'+
b+'"]');setTimeout(function(){null===f||void 0===f?void 0:f.focus();d()},0)})]})})};a.prototype.getRefMarker=function(b){return qc.appendToString(b)};return a}(),vc=function(){function a(){this.mWebImmersiveVideoClickHandler=new uc}a.prototype.addMinHeightToParent=function(b){(b=V["default"].cardRoot.ownerDocument.querySelector("."+b))&&b.parentElement&&(b.parentElement.style.minHeight="inherit")};a.prototype.onVideoClickHandler=function(b){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,
function(c){switch(c.label){case 0:return[4,this.mWebImmersiveVideoClickHandler.onVideoClickHandler(b)];case 1:return c.sent(),[2]}})})};a.prototype.onImageClickHandler=function(b){var c;return g.__awaiter(this,void 0,void 0,function(){var d,e,f,h,l;return g.__generator(this,function(m){switch(m.label){case 0:return d=null===(c=b.currentTarget)||void 0===c?void 0:c.dataset,e=ya["default"].cardRoot.getElementsByClassName("_Y3Itb_media-popover-container_2BBbs")[0],f="cr-media-popover",[4,Ob.get(f,e,
b.currentTarget)];case 1:return h=m.sent(),l=G[d.mediatype],[4,Ca.loadMediaPopover({mediaType:l,asin:d.asin,reviewId:d.reviewid,mediaId:d.physicalid,popoverDetails:{popoverName:f,popover:h}})];case 2:return m.sent(),this.addMinHeightToParent("_Y3Itb_media-popover-container_2BBbs"),b.currentTarget&&b.currentTarget.classList.remove("a-declarative"),[2]}})})};a.prototype.onSeeMoreClickHandler=function(b){var c;return g.__awaiter(this,void 0,void 0,function(){var d,e,f,h;return g.__generator(this,function(l){d=
null===(c=b.currentTarget)||void 0===c?void 0:c.dataset;e=G[d.mediatype];f=Ha(e);h=d.asin;if(f===ia.IMAGE)da["default"].setLocation(eb(pc.toString(),ia.IMAGE,h));else throw N.logError("loadVideoGalleryError",f),Error("Video gallery is not available on mWeb.");return[2]})})};return a}(),wc=function(){function a(){}a.getThumbnailClickHandler=function(){return g.__awaiter(this,void 0,void 0,function(){var b;return g.__generator(this,function(c){switch(c.label){case 0:return[4,hb()];case 1:b=c.sent();
switch(b){case ha.MSHOP:return[2,new rc];case ha.MWEB:return[2,new vc];case ha.DESKTOP:return[2,new kc]}return[2]}})})};return a}(),xc=function(){function a(b){this.clickHandler=this.clickHandler=b}a.prototype.registerThumbnailClickHandlers=function(){this.registerCRVideoThumbnailClickHandler();this.registerCRImageThumbnailClickHandler();this.registerCRSeeMoreThumbnailClickHandler()};a.prototype.registerCRVideoThumbnailClickHandler=function(){var b=this,c=R["default"].setup().define;c(Mb.clickHandler,
"click",function(d){return g.__awaiter(b,void 0,void 0,function(){return g.__generator(this,function(e){switch(e.label){case 0:return[4,this.clickHandler.onVideoClickHandler(d)];case 1:return e.sent(),N.logCounter("videoThumbnail.click",1),[2]}})})})};a.prototype.registerCRImageThumbnailClickHandler=function(){var b=this,c=R["default"].setup().define;c(Kb.clickHandler,"click",function(d){return g.__awaiter(b,void 0,void 0,function(){return g.__generator(this,function(e){switch(e.label){case 0:return[4,
this.clickHandler.onImageClickHandler(d)];case 1:return e.sent(),N.logCounter("imageThumbnail.click",1),[2]}})})})};a.prototype.registerCRSeeMoreThumbnailClickHandler=function(){var b=this,c=R["default"].setup().define;c(Lb.clickHandler,"click",function(d){return g.__awaiter(b,void 0,void 0,function(){var e,f;return g.__generator(this,function(h){switch(h.label){case 0:return[4,this.clickHandler.onSeeMoreClickHandler(d)];case 1:return h.sent(),e=G[null===(f=d.currentTarget)||void 0===f?void 0:f.dataset.mediatype],
N.logCounter("seeMore."+e.toLowerCase()+".click",1),[2]}})})})};return a}(),$a;($a||($a={})).closePopoverClickHandler="ClosePopoverClickHandler";var yc=function(){function a(){}a.registerClosePopoverClickHandler=function(){var b=R["default"].setup().define;b($a.closePopoverClickHandler,"click",function(c){c.stopBubble();Ca.back()})};return a}(),Da;(function(a){a.expandTextClickHandler="expandTextClickHandler";a.hideTextClickHandler="hideTextClickHandler";a.toggleTextClickHandler="toggleTextClickHandler"})(Da||
(Da={}));var zc=function(){function a(){}a.registerTextExpanderClickHandlers=function(){a.registerExpandTextClickHandler();a.registerHideTextClickHandler();a.registerToggleTextClickHandler()};a.registerExpandTextClickHandler=function(){var b=R["default"].setup().define;b(Da.expandTextClickHandler,"click",function(c){c.stopBubble();c=a.getTextExpanderClient(c);null===c||void 0===c?void 0:c.expandText()})};a.registerHideTextClickHandler=function(){var b=R["default"].setup().define;b(Da.hideTextClickHandler,
"click",function(c){c.stopBubble();c=a.getTextExpanderClient(c);null===c||void 0===c?void 0:c.hideText()})};a.registerToggleTextClickHandler=function(){var b=R["default"].setup().define;b(Da.toggleTextClickHandler,"click",function(c){c.stopBubble();c=a.getTextExpanderClient(c);null===c||void 0===c?void 0:c.toggleText()})};a.getTextExpanderClient=function(b){var c;b=null===(c=b.currentTarget)||void 0===c?void 0:c.dataset.reviewid;return Za(U.getPopoverWidgetById(b))};return a}(),rb=function(){function a(){this.errorDialog=
V["default"].cardRoot.ownerDocument.querySelector("._Y3Itb_media-popover-error-dialog_2LoQP")}a.prototype.show=function(){M(this.errorDialog)};a.prototype.hide=function(){I(this.errorDialog)};return a}(),ab;(ab||(ab={})).closeToastBar="closeToastBarClickHandler";var sb=function(){function a(){}a.registerCloseToastBarClickHandler=function(){var b=R["default"].setup().define;b(ab.closeToastBar,"click",function(c){c.stopBubble();c=c.currentTarget.closest("div[data-toast-bar-name='"+c.currentTarget.dataset.toastBarName+
"']");A(c,function(d){return I(d)})})};return a}(),Ac=function(){function a(){}a.prototype.registerMediaPopoverClickHandlers=function(){yc.registerClosePopoverClickHandler();this.registerOpenPopoverReportConfirmationDialog();this.registerHelpfulVoteClickHandler();this.registerMediaOverlayClickHandlers();this.registerNoopHandler();this.registerConfirmReportAbuseClickHandler();this.registerClosePopoverErrorDialogClickHandler();this.registerLoadMediaPopoverClickHandler();sb.registerCloseToastBarClickHandler()};
a.prototype.registerNoopHandler=function(){var b=R["default"].setup().define;b(ba.noopHandler,"click",function(c){c.stopBubble()})};a.prototype.registerMediaOverlayClickHandlers=function(){this.registerMediaOverlayNavigationClickHandlers();zc.registerTextExpanderClickHandlers()};a.prototype.registerClosePopoverErrorDialogClickHandler=function(){var b=R["default"].setup().define;b(ba.closePopoverErrorDialogClickHandler,"click",function(c){c.stopBubble();(new rb).hide()})};a.prototype.registerMediaOverlayNavigationClickHandlers=
function(){var b=R["default"].setup().define;b(ba.popoverClickHandler,"click",function(c){var d=c.event,e=c.currentTarget;var f=d.clientX/e.clientWidth*100;d=d.clientY/e.clientHeight*100;e=(e.clientWidth>e.clientHeight?Aa.LANDSCAPE:Aa.POTRAIT)===Aa.POTRAIT?{lowerBound:33,upperBound:67}:{lowerBound:40,upperBound:80};f=d<=e.lowerBound||d>=e.upperBound?W.NONE:25>=f?W.LEFT:75<=f?W.RIGHT:W.CENTER;(new U(U.getPopoverWidgetById(c.currentTarget.dataset.reviewid))).handlePopoverClick(f)});b(ba.desktopRightClickHandler,
"click",function(c){(new U(U.getPopoverWidgetById(c.currentTarget.dataset.reviewid))).handlePopoverClick(W.RIGHT)});b(ba.desktopLeftClickHandler,"click",function(c){(new U(U.getPopoverWidgetById(c.currentTarget.dataset.reviewid))).handlePopoverClick(W.LEFT)})};a.prototype.registerOpenPopoverReportConfirmationDialog=function(){var b=R["default"].setup().define;b(ba.openReportConfirmationDialogClickHandler,"click",function(c){c.stopBubble();Ca.showReportAbuseConfirmationDialog(c.currentTarget.dataset.id,
c.currentTarget.dataset.asin)})};a.prototype.showErrorDialog=function(){(new Fa).hide();(new rb).show()};a.prototype.registerConfirmReportAbuseClickHandler=function(){var b=this,c=R["default"].setup().define,d=fa["default"].setup(["reportAbuse"]);c(ba.confirmReportAbuseClickHandler,"click",function(e){e.stopBubble();var f=e.currentTarget.firstChild.dataset.id;e=e.currentTarget.firstChild.dataset.asin;d.reportAbuse({reviewId:f,domain:xa(),asin:e}).then(function(h){!h.success&&h.redirectUrl?da["default"].setLocation(h.redirectUrl):
h.success?(Ca.back(),(new U(U.getPopoverWidgetById(f))).scrollIntoNextPopover(),(new sa("reportAbuseThankYouMessage")).show()):b.showErrorDialog()})})};a.prototype.registerHelpfulVoteClickHandler=function(){var b=this,c=R["default"].setup().define,d=fa["default"].setup(["helpful"]);c(ba.helpfulVoteClickHandler,"click",function(e){e.stopBubble();var f=e.currentTarget.dataset.id;e=e.currentTarget.dataset.asin;d.helpful({reviewId:f,domain:xa(),asin:e}).then(function(h){!h.success&&h.redirectUrl?da["default"].setLocation(h.redirectUrl):
h.success?(new Xa(Xa.getActionButtonsContainer(f))).likeButtonClicked():b.showErrorDialog()})})};a.prototype.registerLoadMediaPopoverClickHandler=function(){var b=this,c=R["default"].setup().define;c(ba.loadMediaPopover,"click",function(d){return g.__awaiter(b,void 0,void 0,function(){var e,f,h,l;return g.__generator(this,function(m){switch(m.label){case 0:return e=new qb,f=null===(l=d.currentTarget)||void 0===l?void 0:l.dataset,h=G[f.mediatype],e.show(),e.setLoadingAnimation(!0),[4,Ca.loadMediaPopover({asin:f.asin,
mediaType:h,reviewId:f.reviewid,mediaId:f.mediaid,popoverDetails:{popoverName:f.popovername},isDesktop:!gb()})];case 1:return m.sent(),[2]}})})})};return a}(),Z=R["default"].setup().define,ca=function(a,b){A(a.currentTarget,function(c){var d=jb(c);if(!d.mediaType)throw Error("unable to extract mediaType from element: "+a.operationName+", "+c.nodeName);var e=Ba.getData(d.mediaType);if(!e)throw Error("unable to get modalManager: "+a.operationName+", "+d);b(e,d,c.dataset)})},Bc=function(){Z(X.galleryItemClickHandler,
"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c,d,e){if(!d.reviewId||!d.mediaId)throw Error("reviewId or mediaId was not found on the media gallery item: "+JSON.stringify(e));c.updateModalWithReview(d.reviewId,d.mediaId,d.mediaType)});return[2]})})})},Cc=function(){Z(X.showMediaGalleryClickHandler,"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c){return c.showMediaGallery()});
return[2]})})})},Dc=function(){Z(X.reloadMediaPopover,"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c,d,e){if("true"===e.showgalleryinmodal&&!d.asin)throw Error("asin was not found on the toastbar : "+JSON.stringify(e));if(!("true"===e.showgalleryinmodal||d.reviewId&&d.mediaId&&d.asin))throw Error("reviewId/mediaId/asin was not found on the toastbar : "+JSON.stringify(e));c.loadModal({asin:d.asin,mediaId:d.mediaId,reviewId:d.reviewId,
mediaType:d.mediaType,showGalleryInModal:"true"==e.showgalleryinmodal?!0:!1,popoverDetails:{popoverName:e.popovername}})});return[2]})})})},Ec=function(){Z(X.thumbnailClickHandler,"click",function(a){ca(a,function(b,c,d){if(!c.mediaId)throw Error("mediaId was not found while clicking on media thumbnail: "+d);b.updateMediaInModal(c.mediaId)})})},Fc=function(){Z(X.rightClickHandler,"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c){return c.handleModalMediaProgressionClick(W.RIGHT)});
return[2]})})});Z(X.leftClickHandler,"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c){return c.handleModalMediaProgressionClick(W.LEFT)});return[2]})})})},Gc=function(){Z(X.expandTextClickHandler,"click",function(a){ca(a,function(b){return b.handleExpanderClick(ua.EXPAND)})});Z(X.hideTextClickHandler,"click",function(a){ca(a,function(b){return b.handleExpanderClick(ua.HIDE)})})},Hc=function(){Z(X.openReportConfirmationDialogClickHandler,
"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(d){c.openReportAbuseDialog(a.currentTarget);return[2]})})});return[2]})})});Z(X.confirmReportAbuseClickHandler,"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,
function(d){c.handleReportAbuseClick();return[2]})})});return[2]})})})},Ic=function(){Z(X.helpfulVoteClickHandler,"click",function(a){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(b){ca(a,function(c){return g.__awaiter(void 0,void 0,void 0,function(){return g.__generator(this,function(d){c.handleHelpulVoteClick();return[2]})})});return[2]})})})},Jc=function(){Z(X.closeMediaPopover,"click",function(a){ca(a,function(b){return g.__awaiter(void 0,void 0,void 0,
function(){return g.__generator(this,function(c){b.closeModal();return[2]})})})})},Kc=function(){Z(X.noopHandler,"click",function(a){a.stopBubble()})},Lc=function(){return g.__awaiter(void 0,void 0,void 0,function(){var a,b;return g.__generator(this,function(c){switch(c.label){case 0:return[4,hb()];case 1:a=c.sent();switch(a){case ha.DESKTOP:Bc();Cc();Dc();Ec();Fc();Gc();Hc();Ic();Kc();Jc();sb.registerCloseToastBarClickHandler();break;case ha.MWEB:b=new Ac,b.registerMediaPopoverClickHandlers()}return[2]}})})},
tb;(function(a){a[a.LEFT=0]="LEFT";a[a.CENTER=1]="CENTER";a[a.RIGHT=2]="RIGHT";a[a.NONE=3]="NONE"})(tb||(tb={}));var ub;(function(a){a[a.POTRAIT=0]="POTRAIT";a[a.LANDSCAPE=1]="LANDSCAPE"})(ub||(ub={}));var K=function(a,b){return b?b.querySelector("*[data-hook="+a+"]"):V["default"].cardRoot.ownerDocument.querySelector("*[data-hook="+a+"]")},Mc=function(a,b){return Array.from((b||V["default"].cardRoot.ownerDocument).querySelectorAll("["+a+"]")).map(function(c){return c.getAttribute(a)}).filter(function(c){return null!==
c})},Ga=function(a){return V["default"].cardRoot.ownerDocument.getElementById(a)},Y=function(a){a.style.display="flex"},H=function(a){a.style.display="none"},bb=function(){function a(b,c,d){this.reviewId=b;this.locale=c;this.sourceLanguage=d;this.reviewContainer=Ga("cr-single-review-"+b);this.reviewTextContainer=K("reviewTextContainer",this.reviewContainer);this.reviewText=K("reviewText",this.reviewContainer);this.reviewTitle=K("reviewTitle",this.reviewContainer);this.translateButton=K("translateButton",
this.reviewContainer);this.seeOriginalButton=K("seeOriginalButton",this.reviewContainer);this.translationInfo=K("translationInfo",this.reviewContainer);this.translationSpinner=K("translationSpinner",this.reviewTextContainer);this.translationErrorMessage=K("translationErrorMessage",this.reviewContainer);this.helpfulVoteButton=K("helpfulVoteButton",this.reviewContainer);this.helpfulVoteErrorMessage=K("helpfulVoteErrorMessage",this.reviewContainer);this.helpfulVoteSuccessMessage=K("helpfulVoteSuccessMessage",
this.reviewContainer);this.helpfulVoteLoadingMessage=K("helpfulVoteLoadingMessage",this.reviewContainer);this.reportAbuseButton=K("reportAbuseButton",this.reviewContainer);this.reportAbuseSendingMessage=K("reportAbuseSendingMessage",this.reviewContainer);this.reportAbuseSuccessMessage=K("reportAbuseSuccessMessage",this.reviewContainer);this.reportAbuseErrorMessage=K("reportAbuseErrorMessage",this.reviewContainer);this.shareButton=Ga("shareButton-"+b);this.init()}a.prototype.init=function(){this.hideTranslationSpinner()};
a.prototype.updateText=function(b){this.reviewTextContainer=K("reviewTextContainer",this.reviewContainer);this.reviewText=K("reviewText",this.reviewContainer);this.reviewTextContainer&&this.reviewText&&this.reviewTextContainer.replaceChild(b,this.reviewText)};a.prototype.updateTitle=function(b){this.reviewTitle=K("reviewTitle",this.reviewContainer);this.reviewContainer&&this.reviewTitle&&this.reviewContainer.replaceChild(b,this.reviewTitle)};a.prototype.showTranslateButton=function(){this.translateButton&&
this.translationInfo&&this.seeOriginalButton&&(H(this.translationInfo),H(this.seeOriginalButton),Y(this.translateButton))};a.prototype.showSeeOriginalButton=function(){this.translateButton&&this.translationInfo&&this.seeOriginalButton&&(Y(this.translationInfo),Y(this.seeOriginalButton),H(this.translateButton))};a.prototype.showTranslationSpinner=function(){this.translationSpinner&&(this.translationSpinner.style.display="contents")};a.prototype.hideTranslationSpinner=function(){this.translationSpinner&&
H(this.translationSpinner)};a.prototype.showTranslationErrorMessage=function(){this.translationErrorMessage&&Y(this.translationErrorMessage)};a.prototype.hideTranslationErrorMessage=function(){this.translationErrorMessage&&H(this.translationErrorMessage)};a.prototype.showHelpfulVoteSuccessMessage=function(){this.helpfulVoteErrorMessage&&this.helpfulVoteSuccessMessage&&this.helpfulVoteButton&&this.helpfulVoteLoadingMessage&&(H(this.helpfulVoteButton),H(this.helpfulVoteLoadingMessage),Y(this.helpfulVoteSuccessMessage),
H(this.helpfulVoteErrorMessage))};a.prototype.showHelpfulVoteErrorMessage=function(){this.helpfulVoteErrorMessage&&this.helpfulVoteSuccessMessage&&this.helpfulVoteButton&&this.helpfulVoteLoadingMessage&&(H(this.helpfulVoteButton),H(this.helpfulVoteLoadingMessage),H(this.helpfulVoteSuccessMessage),Y(this.helpfulVoteErrorMessage))};a.prototype.showHelpfulVoteLoadingMessage=function(){this.helpfulVoteErrorMessage&&this.helpfulVoteSuccessMessage&&this.helpfulVoteButton&&this.helpfulVoteLoadingMessage&&
(H(this.helpfulVoteButton),Y(this.helpfulVoteLoadingMessage),H(this.helpfulVoteSuccessMessage),H(this.helpfulVoteErrorMessage))};a.prototype.showReportAbuseSendingMessage=function(){this.reportAbuseButton&&this.reportAbuseSendingMessage&&this.reportAbuseSuccessMessage&&this.reportAbuseErrorMessage&&(H(this.reportAbuseButton),Y(this.reportAbuseSendingMessage),H(this.reportAbuseSuccessMessage),H(this.reportAbuseErrorMessage))};a.prototype.showReportAbuseErrorMessage=function(){this.reportAbuseButton&&
this.reportAbuseSendingMessage&&this.reportAbuseSuccessMessage&&this.reportAbuseErrorMessage&&(H(this.reportAbuseButton),H(this.reportAbuseSendingMessage),H(this.reportAbuseSuccessMessage),Y(this.reportAbuseErrorMessage))};a.prototype.showReportAbuseSuccessMessage=function(){this.reportAbuseButton&&this.reportAbuseSendingMessage&&this.reportAbuseSuccessMessage&&this.reportAbuseErrorMessage&&(H(this.reportAbuseButton),H(this.reportAbuseSendingMessage),Y(this.reportAbuseSuccessMessage),H(this.reportAbuseErrorMessage))};
a.prototype.updateShareReviewURL=function(b){if(this.shareButton){var c=this.shareButton.getAttribute("data-ssf-share-icon");c=JSON.parse(c);var d=da["default"].getLocation&&da["default"].getLocation().host||location.host;c.url="https://"+d+"/gp/aw/review/"+b+"/"+this.reviewId;this.shareButton.setAttribute("data-ssf-share-icon",JSON.stringify(c))}};a.getInstance=function(b){this.instance||(this.instance=new a(b));return this.instance};return a}(),vb=function(){function a(){this.singleReviewManagers=
new Map;this.internationalTranslatedBy=this.internationalSeeOriginalButton=this.internationalTranslateAllReviewsButton=this.internationalTopReviews=this.localTranslatedBy=this.localSeeOriginalButton=this.localTranslateAllReviewsButton=this.localTopReviews=null}a.prototype.initializeDomElements=function(){if(this.localTopReviews=Ga("localTopReviews"))this.localTranslateAllReviewsButton=K("translateAllButtonContainer",this.localTopReviews),this.localSeeOriginalButton=K("showOriginalButtonContainer",
this.localTopReviews),this.localTranslatedBy=K("translatedByContainer",this.localTopReviews);if(this.internationalTopReviews=Ga("internationalTopReviews"))this.internationalTranslateAllReviewsButton=K("translateAllButtonContainer",this.internationalTopReviews),this.internationalSeeOriginalButton=K("showOriginalButtonContainer",this.internationalTopReviews),this.internationalTranslatedBy=K("translatedByContainer",this.internationalTopReviews)};a.prototype.getReviewManager=function(b){var c=this.singleReviewManagers.get(b);
c||(c=new bb(b),this.singleReviewManagers.set(b,c));return c};a.prototype.addReviewManager=function(b,c){this.singleReviewManagers.set(b,c)};a.prototype.removeReviewManager=function(b){return this.singleReviewManagers.delete(b)};a.prototype.hasReviewManager=function(b){return this.singleReviewManagers.has(b)};a.prototype.getAllReviewIds=function(){return Array.from(this.singleReviewManagers.keys())};a.prototype.getReviewCount=function(){return this.singleReviewManagers.size};a.prototype.clear=function(){this.singleReviewManagers.clear()};
a.prototype.getReviewIdsFromList=function(b){return(b=b?this.internationalTopReviews:this.localTopReviews)?Mc("data-reviewid",b):[]};a.prototype.showTranslateAllButton=function(b){b?(b=this.internationalTranslateAllReviewsButton)&&b.classList.remove("aok-hidden"):(b=this.localTranslateAllReviewsButton)&&b.classList.remove("aok-hidden")};a.prototype.hideTranslateAllButton=function(b){b?(b=this.internationalTranslateAllReviewsButton)&&b.classList.add("aok-hidden"):(b=this.localTranslateAllReviewsButton)&&
b.classList.add("aok-hidden")};a.prototype.showSeeOriginalButton=function(b){b?Y(this.internationalSeeOriginalButton):Y(this.localSeeOriginalButton)};a.prototype.hideSeeOriginalButton=function(b){b?H(this.internationalSeeOriginalButton):H(this.localSeeOriginalButton)};a.prototype.showTranslatedContainer=function(b){b?Y(this.internationalTranslatedBy):Y(this.localTranslatedBy)};a.prototype.hideTranslatedContainer=function(b){b?H(this.internationalTranslatedBy):H(this.localTranslatedBy)};a.prototype.showTranslatedState=
function(b){this.hideTranslateAllButton(b);this.showSeeOriginalButton(b);this.showTranslatedContainer(b)};a.prototype.showOriginalState=function(b){this.showTranslateAllButton(b);this.hideSeeOriginalButton(b);this.hideTranslatedContainer(b)};a.getInstance=function(){a.instance||(a.instance=new a);return a.instance};return a}().getInstance(),cb=function(a){return vb.hasReviewManager(a)?vb.getReviewManager(a):bb.getInstance(a)},Nc=function(){function a(){this.cache=new Map;this.ignoreReviewIds=new Set;
this.remoteDataOperationProxy=fa["default"].setup(["translateReview"])}a.prototype.addReviewdIdsToIgnoreList=function(b){this.ignoreReviewIds.add(b)};a.prototype.renderAllTranslatedReviews=function(b,c){return g.__awaiter(this,void 0,void 0,function(){var d,e,f,h,l,m,t,p,z,k,q,n,C,u,v,x,D=this;return g.__generator(this,function(J){switch(J.label){case 0:d=fa["default"].setup(["translateAllReviews"]);e=fa["default"].setup(["renderReviewTitle","renderReviewText"]);f=b.map(function(y){return cb(y)});
h=[];try{for(l=g.__values(b),m=l.next();!m.done;m=l.next())t=m.value,p=this.cache.get(t),z=f[b.indexOf(t)],p&&p.translatedText&&p.translatedTitle?(z.hideTranslationErrorMessage(),z.updateText(p.translatedText.cloneNode(!0)),z.updateTitle(p.translatedTitle.cloneNode(!0)),z.showSeeOriginalButton()):this.ignoreReviewIds.has(t)||(h.push(t),z.hideTranslationErrorMessage(),z.showTranslationSpinner())}catch(y){v={error:y}}finally{try{m&&!m.done&&(x=l.return)&&x.call(l)}finally{if(v)throw v.error;}}if(!(0<
h.length))return[3,4];J.label=1;case 1:return J.trys.push([1,3,,4]),[4,d.translateAllReviews({reviewIds:h,isMobile:c})];case 2:return k=J.sent(),q=new Map,n=new Map,C=[],u=[],k.forEach(function(y){y&&y.reviewId&&(q.set(y.reviewId,y),y.translatedText&&y.translatedTitle?n.set(y.reviewId,y):422===y.statusCode?C.push(y.reviewId):u.push(y.reviewId))}),h.forEach(function(y){q.has(y)||u.push(y)}),0<n.size&&Promise.allSettled(Array.from(n.entries()).map(function(y){y=g.__read(y,2);var B=y[0],r=y[1];return g.__awaiter(D,
void 0,void 0,function(){var w,E,Q,S,ja,va,la,ka;return g.__generator(this,function(aa){switch(aa.label){case 0:w=f[b.indexOf(B)],E=w.reviewText?w.reviewText.cloneNode(!0):null,Q=w.reviewTitle?w.reviewTitle.cloneNode(!0):null,aa.label=1;case 1:return aa.trys.push([1,3,,4]),[4,Promise.all([e.renderReviewText({isCardExpanded:!0,language:r.targetLanguage,text:r.translatedText}),e.renderReviewTitle({language:r.targetLanguage,isMobile:c,title:r.translatedTitle})])];case 2:return S=g.__read.apply(void 0,
[aa.sent(),2]),ja=S[0],va=S[1],la=ea.unscope(ja),ka=ea.unscope(va),this.cache.set(B,{originalText:E,originalTitle:Q,targetLanguage:r.targetLanguage,translatedText:la,translatedTitle:ka}),la&&ka?(w.hideTranslationErrorMessage(),w.hideTranslationSpinner(),w.updateText(la),w.updateTitle(ka),w.showSeeOriginalButton()):(w.hideTranslationSpinner(),w.showTranslationErrorMessage()),[3,4];case 3:return aa.sent(),w.hideTranslationSpinner(),w.showTranslationErrorMessage(),[3,4];case 4:return[2]}})})})),u.forEach(function(y){y=
f[b.indexOf(y)];y.hideTranslationSpinner();y.showTranslationErrorMessage()}),C.forEach(function(y){D.renderTranslatedReview(y,c,a.DEFAULT_RETRIES-1)}),[3,4];case 3:return J.sent(),f.forEach(function(y){y.hideTranslationSpinner();y.showTranslationErrorMessage()}),[3,4];case 4:return[2]}})})};a.prototype.renderTranslatedReview=function(b,c,d){void 0===d&&(d=a.DEFAULT_RETRIES);return g.__awaiter(this,void 0,void 0,function(){var e,f,h,l,m,t,p,z,k,q,n;return g.__generator(this,function(C){switch(C.label){case 0:e=
cb(b);f=fa["default"].setup(["renderReviewTitle","renderReviewText"]);h=this.cache.get(b);if(!(h&&h.translatedText&&h.translatedTitle))return[3,1];e.hideTranslationErrorMessage();e.updateText(h.translatedText.cloneNode(!0));e.updateTitle(h.translatedTitle.cloneNode(!0));e.showSeeOriginalButton();return[3,7];case 1:m=l=null,h?(l=h.originalText,m=h.originalTitle):(l=e.reviewText?e.reviewText.cloneNode(!0):null,m=e.reviewTitle?e.reviewTitle.cloneNode(!0):null),e.hideTranslationErrorMessage(),e.showTranslationSpinner(),
C.label=2;case 2:return C.trys.push([2,6,,7]),[4,this.translateReviewDataOperation(b,d)];case 3:return(t=C.sent())&&t.translatedText&&t.translatedTitle?[4,Promise.all([f.renderReviewText({isCardExpanded:!0,language:t.targetLanguage,text:t.translatedText}),f.renderReviewTitle({language:t.targetLanguage,isMobile:c,title:t.translatedTitle})])]:[3,5];case 4:p=g.__read.apply(void 0,[C.sent(),2]),z=p[0],k=p[1],q=ea.unscope(z),n=ea.unscope(k),e.hideTranslationSpinner(),this.cache.set(b,{originalText:l,originalTitle:m,
targetLanguage:t.targetLanguage,translatedText:q,translatedTitle:n}),q&&n&&(e.hideTranslationErrorMessage(),e.updateText(q),e.updateTitle(n),e.showSeeOriginalButton()),C.label=5;case 5:return[3,7];case 6:return C.sent(),e.hideTranslationSpinner(),e.showTranslationErrorMessage(),[3,7];case 7:return[2]}})})};a.prototype.translateReviewDataOperation=function(b,c){void 0===c&&(c=a.DEFAULT_RETRIES);return g.__awaiter(this,void 0,void 0,function(){var d,e,f,h;return g.__generator(this,function(l){switch(l.label){case 0:d=
function(m){var t,p;return g.__generator(this,function(z){switch(z.label){case 0:return[4,e.remoteDataOperationProxy.translateReview({reviewId:b})];case 1:return t=z.sent(),t.translatedText&&t.translatedTitle?[2,{value:t}]:[3,2];case 2:if(!t.statusCode||422!=t.statusCode)return[3,4];p=Math.min((null===t||void 0===t?void 0:t.retryDelayinSeconds)||a.DEFAULT_RETRY_TIME,3);return[4,new Promise(function(k){return setTimeout(k,1E3*p)})];case 3:return z.sent(),[2,"continue"];case 4:return[2]}})},e=this,
f=0,l.label=1;case 1:return f<c?[5,d(f)]:[3,4];case 2:h=l.sent();if("object"===typeof h)return[2,h.value];l.label=3;case 3:return f++,[3,1];case 4:throw Error;}})})};a.prototype.renderOriginalReviews=function(b){return g.__awaiter(this,void 0,void 0,function(){var c,d,e,f,h,l;return g.__generator(this,function(m){switch(m.label){case 0:m.trys.push([0,5,6,7]),c=g.__values(b),d=c.next(),m.label=1;case 1:if(d.done)return[3,4];e=d.value;return[4,this.renderOriginalReview(e)];case 2:m.sent(),m.label=3;
case 3:return d=c.next(),[3,1];case 4:return[3,7];case 5:return f=m.sent(),h={error:f},[3,7];case 6:try{d&&!d.done&&(l=c.return)&&l.call(c)}finally{if(h)throw h.error;}return[7];case 7:return[2]}})})};a.prototype.renderOriginalReview=function(b){return g.__awaiter(this,void 0,void 0,function(){var c,d;return g.__generator(this,function(e){c=cb(b);(d=this.cache.get(b))&&d.originalText&&d.originalTitle&&(c.hideTranslationErrorMessage(),c.updateText(d.originalText.cloneNode(!0)),c.updateTitle(d.originalTitle.cloneNode(!0)),
c.showTranslateButton());return[2]})})};a.getInstance=function(){a.instance||(a.instance=new a);return a.instance};a.DEFAULT_RETRIES=3;a.DEFAULT_RETRY_TIME=2;return a}().getInstance(),Oc=function(a){return g.__awaiter(void 0,void 0,void 0,function(){var b,c,d,e,f,h,l;return g.__generator(this,function(m){switch(m.label){case 0:return b=a||ya["default"].cardRoot,c=b.getAttribute("data-reviewid")||(b.id?b.id.replace("cr-single-review-",""):""),d="true"===b.getAttribute("data-mobile"),e=b.getAttribute("data-asin")||
"",f=b.getAttribute("data-locale")||"",h=b.getAttribute("data-sourcelanguage")||"",c?a||"fr-CA"!==f||"fr-CA"===h?[3,2]:[4,Nc.renderTranslatedReview(c,d)]:[2,null];case 1:m.sent(),m.label=2;case 2:return l=new bb(c,f,h),l.updateShareReviewURL(e),[2,l]}})})};db._operationNames=[];db.card=function(){return g.__awaiter(void 0,void 0,void 0,function(){var a,b,c,d,e;return g.__generator(this,function(f){switch(f.label){case 0:return N.setPrefix("cr-media-carousel"),[4,wc.getThumbnailClickHandler()];case 1:return a=
f.sent(),b=new xc(a),b.registerThumbnailClickHandlers(),[4,Ma()];case 2:return f.sent()?[3,4]:[4,Lc()];case 3:f.sent(),f.label=4;case 4:c=ta.setup(["getTreatmentNoTrigger"]),f.label=5;case 5:return f.trys.push([5,9,,10]),[4,c.getTreatmentNoTrigger({weblabID:"COFEE_DD_MEDIA_CARDS_MIGRATION_SHARED_LIBRARY_1247512"})];case 6:return d=f.sent(),"T1"!==d?[3,8]:[4,Oc()];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:return e=f.sent(),N.logError("client.getWeblabTreatmentError",e),[3,10];case 10:return N.logCounter("client.loaded",
1),[2]}})})}});
